'use strict';(function(f){"object"==typeof exports&&"object"==typeof module?f(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],f):f(CodeMirror)})(function(f){function v(a,d){function b(a){if(!e.parentNode)return f.off(document,"mousemove",b);e.style.top=Math.max(0,a.clientY-e.offsetHeight-5)+"px";e.style.left=a.clientX+5+"px"}var e=document.createElement("div");e.className="CodeMirror-lint-tooltip";e.appendChild(d.cloneNode(!0));document.body.appendChild(e);
f.on(document,"mousemove",b);b(a);null!=e.style.opacity&&(e.style.opacity=1);return e}function w(a){a.parentNode&&(null==a.style.opacity&&a.parentNode&&a.parentNode.removeChild(a),a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},600))}function q(a,d,b){function e(){f.off(b,"mouseout",e);c&&(w(c),c=null)}var c=v(a,d),h=setInterval(function(){if(c)for(var a=b;;a=a.parentNode){a&&11==a.nodeType&&(a=a.host);if(a==document.body)return;if(!a){e();break}}if(!c)return clearInterval(h)},
400);f.on(b,"mouseout",e)}function x(a,d,b){this.marked=[];this.options=d;this.timeout=null;this.hasGutter=b;this.onMouseOver=function(b){var c=b.target||b.srcElement;if(/\bCodeMirror-lint-mark-/.test(c.className)){for(var c=c.getBoundingClientRect(),d=a.findMarksAt(a.coordsChar({left:(c.left+c.right)/2,top:(c.top+c.bottom)/2},"client")),c=[],g=0;g<d.length;++g){var f=d[g].__annotation;f&&c.push(f)}if(c.length){d=b.target||b.srcElement;g=document.createDocumentFragment();for(f=0;f<c.length;f++)g.appendChild(r(c[f]));
q(b,g,d)}}};this.waitingFor=0}function t(a){var d=a.state.lint;d.hasGutter&&a.clearGutter("CodeMirror-lint-markers");for(a=0;a<d.marked.length;++a)d.marked[a].clear();d.marked.length=0}function y(a,d,b,e){var c=document.createElement("div"),h=c;c.className="CodeMirror-lint-marker-"+d;b&&(h=c.appendChild(document.createElement("div")),h.className="CodeMirror-lint-marker-multiple");if(0!=e)f.on(h,"mouseover",function(b){q(b,a,h)});return c}function r(a){var d=a.severity;d||(d="error");var b=document.createElement("div");
b.className="CodeMirror-lint-message-"+d;b.appendChild(document.createTextNode(a.message));return b}function z(a,d,b){function e(){h=-1;a.off("change",e)}var c=a.state.lint,h=++c.waitingFor;a.on("change",e);d(a.getValue(),function(b,d){a.off("change",e);c.waitingFor==h&&(d&&b instanceof f&&(b=d),n(a,b))},b,a)}function l(a,d){var b=a.state.lint.options,e=b.options||b,c=(d?null:b.getAnnotations)||a.getHelper(f.Pos(0,0),"lint");c&&(d||!b.async&&!c.async?(b=c(a.getValue(),e,a))&&(b.then?b.then(function(b){n(a,
b)}):n(a,b)):z(a,c,e))}function n(a,d){t(a);for(var b=a.state.lint,e=b.options,c=[],f=0;f<d.length;++f){var g=d[f],m=g.from.line;(c[m]||(c[m]=[])).push(g)}for(f=0;f<c.length;++f)if(g=c[f]){for(var m=null,n=b.hasGutter&&document.createDocumentFragment(),l=0;l<g.length;++l){var k=g[l],p=k.severity;p||(p="error");"error"!=m&&(m=p);e.formatAnnotation&&(k=e.formatAnnotation(k));b.hasGutter&&n.appendChild(r(k));k.to&&b.marked.push(a.markText(k.from,k.to,{className:"CodeMirror-lint-mark-"+p,__annotation:k}))}b.hasGutter&&
a.setGutterMarker(f,"CodeMirror-lint-markers",y(n,m,1<g.length,b.options.tooltips))}if(e.onUpdateLinting)e.onUpdateLinting(d,c,a)}function u(a){var d=a.state.lint;d&&(clearTimeout(d.timeout),d.timeout=setTimeout(function(){l(a)},d.options.delay||500))}f.defineOption("lint",!1,function(a,d,b){b&&b!=f.Init&&(t(a),!1!==a.state.lint.options.lintOnChange&&a.off("change",u),f.off(a.getWrapperElement(),"mouseover",a.state.lint.onMouseOver),clearTimeout(a.state.lint.timeout),delete a.state.lint);if(d){var e=
a.getOption("gutters");b=!1;for(var c=0;c<e.length;++c)"CodeMirror-lint-markers"==e[c]&&(b=!0);e=a.state;c=d;c instanceof Function?c={getAnnotations:c}:c&&!0!==c||(c={});b=e.lint=new x(a,c,b);if(!1!==b.options.lintOnChange)a.on("change",u);if(0!=b.options.tooltips&&"gutter"!=b.options.tooltips)f.on(a.getWrapperElement(),"mouseover",b.onMouseOver);!1!==d.lintOnChange&&l(a)}});f.defineExtension("performLint",function(a){this.state.lint&&l(this,a)})});
