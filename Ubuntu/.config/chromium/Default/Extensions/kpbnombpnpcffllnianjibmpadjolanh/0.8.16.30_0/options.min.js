"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};$(document).ready(function(){function a(a,b){if(b)if(a instanceof Array)for(var c=0,d=a.length;c<d&&b.call(a[c],c)!==!1;c++);else if("object"===("undefined"==typeof a?"undefined":_typeof(a))){var e=null;for(e in a)if(b.call(a[e],e)===!1)break}}function b(){var b=f.get("favouritesList"),c=f.get("favouritesIdList"),d=$("#up-list");a(b,function(a){var e=b[a],g=$('<button class="button on delete" />').text("取消关注"),h=$("<li />").attr("roomId",e.roomId).append($('<span class="upName"/>').text(e.upName),g);d.append(h),g.click(function(){var d=c.indexOf(parseInt(a));d!==-1&&(c.splice(d,1),delete b[a],f.set("favouritesIdList",c),f.set("favouritesList",b),h.remove())})})}function c(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])===a)return decodeURIComponent(e[1])}}function d(a){var b=new Date(1e3*parseInt(a)),c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;return c=String(b.getFullYear()),d=String(b.getMonth()+1),1===d.length&&(d="0"+d),e=String(b.getDate()),1===e.length&&(e="0"+e),f=String(b.getHours()),1===f.length&&(f="0"+f),g=String(b.getMinutes()),1===g.length&&(g="0"+g),h=String(b.getSeconds()),1===h.length&&(h="0"+h),String(c+"-"+d+"-"+e+" "+f+":"+g+":"+h)}var e=chrome.extension.getBackgroundPage(),f={};document.title=chrome.i18n.getMessage("extShortName")+" - "+chrome.i18n.getMessage("optionPage"),f.set=function(a,b,c){if(window.localStorage&&a){var d=window.localStorage;d[a]||(d[a]=JSON.stringify({}));var e=JSON.parse(d[a]);void 0===c?d[a]="string"==typeof b?b.trim():JSON.stringify(b):(e[b]="string"==typeof c?c.trim():JSON.stringify(c),d[a]=JSON.stringify(e))}},f.get=function(a,b,c){if(window.localStorage&&a){if(!window.localStorage[a]){var d={};void 0!==b&&void 0!==c&&(d[b]=c),window.localStorage[a]=JSON.stringify(d)}var e=JSON.parse(window.localStorage[a]);return void 0===b?e:("true"!==e[b]&&"false"!==e[b]||(e[b]=JSON.parse(e[b])),e[b])}},f.del=function(a,b){if(window.localStorage&&void 0!==a&&void 0!==window.localStorage[a]){if(void 0===b)return void window.localStorage.removeItem(a);var c=JSON.parse(window.localStorage[a]);delete c[b],window.localStorage[a]=JSON.stringify(c)}},$("#menu_title").text(chrome.i18n.getMessage("extShortName")),$("#version").html(e.version),$("#ad_opacity_opt").hide(),$('div[option="'+e.getOption("contextmenu")+'"].contextmenu').addClass("on"),$('div[option="'+e.getOption("dynamic")+'"].dynamic').addClass("on"),$('div[option="'+e.getOption("ad")+'"].ad').addClass("on"),$('div[option="'+e.getOption("autooffset")+'"].autooffset').addClass("on"),$('div[option="'+e.getOption("giftpackage")+'"].giftpackage').addClass("on"),$('div[option="'+e.getOption("dlquality")+'"].dlquality').addClass("on"),$('div[option="'+e.getOption("autowide")+'"].autowide').addClass("on"),$(".autowide").click(function(){return!$(this).hasClass("on")&&($(".autowide").removeClass("on"),$(this).addClass("on"),void e.setOption("autowide",$(this).attr("option"),!0))}),$('div[option="'+e.getOption("autooffset")+'"].autooffset').addClass("on"),$('div[option="'+e.getOption("indexversion")+'"].indexversion').addClass("on"),$('div[option="'+e.getOption("rel_search")+'"].rel_search').addClass("on"),$('div[option="'+e.getOption("doSign")+'"].doSign').addClass("on"),$('div[option="'+e.getOption("autoTreasure")+'"].autoTreasure').addClass("on"),$('div[option="'+e.getOption("danmu")+'"].danmu').addClass("on"),$('div[option="'+e.getOption("liveNotification")+'"].liveNotification').addClass("on"),$('div[option="'+e.getOption("chatDisplay")+'"].chatDisplay').addClass("on");var g=JSON.parse(e.getOption("displayOption"));$(".display-option .option .button[option=off]").addClass("on"),a(g,function(a){$(".display-option .option ."+g[a]+'[option="off"]').removeClass("on"),$(".display-option .option ."+g[a]+'[option="on"]').addClass("on")}),$('div[option="'+e.getOption("watcher")+'"].watcher').addClass("on");var h=JSON.parse(e.getOption("watchList"));$(".watcher-option .option .button[option=off]").addClass("on"),a(h,function(a){$(".watcher-option .option ."+h[a]+'[option="off"]').removeClass("on"),$(".watcher-option .option ."+h[a]+'[option="on"]').addClass("on")}),$('div[option="'+e.getOption("watchNotify")+'"].watchNotify').addClass("on");var i=JSON.parse(e.getOption("watchNotifyList"));$(".watcher-notify-option .option .button[option=off]").addClass("on"),a(i,function(a){$(".watcher-notify-option .option ."+i[a]+'[option="off"]').removeClass("on"),$(".watcher-notify-option .option ."+i[a]+'[option="on"]').addClass("on")}),$(".dynamic").click(function(){return!$(this).hasClass("on")&&($(".dynamic").removeClass("on"),$(this).addClass("on"),void e.setOption("dynamic",$(this).attr("option")))}),$(".ad").click(function(){return!$(this).hasClass("on")&&($(".ad").removeClass("on"),$(this).addClass("on"),void e.setOption("ad",$(this).attr("option")))}),$(".contextmenu").click(function(){return!$(this).hasClass("on")&&($(".contextmenu").removeClass("on"),$(this).addClass("on"),e.setOption("contextmenu",$(this).attr("option")),void("on"===$(this).attr("option")?chrome.contextMenus.create({title:chrome.i18n.getMessage("searchBili"),contexts:["selection"],onclick:e.searchBilibili}):chrome.contextMenus.removeAll()))}),$(".dlquality").click(function(){return!$(this).hasClass("on")&&($(".dlquality").removeClass("on"),$(this).addClass("on"),void e.setOption("dlquality",$(this).attr("option")))}),$(".indexversion").click(function(){return!$(this).hasClass("on")&&($(".indexversion").removeClass("on"),$(this).addClass("on"),void e.setOption("indexversion",$(this).attr("option")))}),$(".rel_search").click(function(){return!$(this).hasClass("on")&&($(".rel_search").removeClass("on"),$(this).addClass("on"),void e.setOption("rel_search",$(this).attr("option")))}),$(".autowide").click(function(){return!$(this).hasClass("on")&&($(".autowide").removeClass("on"),$(this).addClass("on"),void e.setOption("autowide",$(this).attr("option")))}),$(".autooffset").click(function(){return!$(this).hasClass("on")&&($(".autooffset").removeClass("on"),$(this).addClass("on"),void e.setOption("autooffset",$(this).attr("option")))}),$(".doSign").click(function(){return!$(this).hasClass("on")&&($(".doSign").removeClass("on"),$(this).addClass("on"),void e.setOption("doSign",$(this).attr("option")))}),$(".autoTreasure").click(function(){return!$(this).hasClass("on")&&($(".autoTreasure").removeClass("on"),$(this).addClass("on"),void e.setOption("autoTreasure",$(this).attr("option")))}),$(".danmu").click(function(){return!$(this).hasClass("on")&&($(".danmu").removeClass("on"),$(this).addClass("on"),void e.setOption("danmu",$(this).attr("option")))}),$(".giftpackage").click(function(){return!$(this).hasClass("on")&&($(".giftpackage").removeClass("on"),$(this).addClass("on"),void e.setOption("giftpackage",$(this).attr("option")))}),$(".liveNotification").click(function(){return!$(this).hasClass("on")&&($(".liveNotification").removeClass("on"),$(this).addClass("on"),e.setOption("liveNotification",$(this).attr("option")),void("on"!==e.getOption("liveNotification")?clearInterval(e.Live.notise.intervalNum):"on"===e.getOption("liveNotification")&&e.Live.notise.init()))}),$(".chatDisplay").click(function(){return!$(this).hasClass("on")&&($(".chatDisplay").removeClass("on"),$(this).addClass("on"),void e.setOption("chatDisplay",$(this).attr("option")))}),$(".chat-display .display-option .option .button").click(function(){var a=$(this).attr("class").split(" ")[1];if($(this).hasClass("on"))return!1;$("."+a).removeClass("on"),$(this).addClass("on");var b=JSON.parse(e.getOption("displayOption")),c=$(this).attr("option");if("on"===c)b.indexOf(a)===-1&&b.push(a);else{var d=b.indexOf(a);d!==-1&&b.splice(d,1)}e.setOption("displayOption",JSON.stringify(b))}),$(".watcher").click(function(){return!$(this).hasClass("on")&&($(".watcher").removeClass("on"),$(this).addClass("on"),void e.setOption("watcher",$(this).attr("option")))}),$(".watcher-options .watcher-option .option .button").click(function(){var a=$(this).attr("class").split(" ")[1];if($(this).hasClass("on"))return!1;$(".watcher-options ."+a).removeClass("on"),$(this).addClass("on");var b=JSON.parse(e.getOption("watchList")),c=$(this).attr("option");if("on"===c)b.indexOf(a)===-1&&b.push(a);else{var d=b.indexOf(a);b.indexOf(a)!==-1&&b.splice(d,1)}e.setOption("watchList",JSON.stringify(b))}),$(".watchNotify").click(function(){return!$(this).hasClass("on")&&($(".watchNotify").removeClass("on"),$(this).addClass("on"),void e.setOption("watchNotify",$(this).attr("option")))}),$(".watcher-notify-options .watcher-notify-option .option .button").click(function(){var a=$(this).attr("class").split(" ")[1];if($(this).hasClass("on"))return!1;$(".watcher-notify-options ."+a).removeClass("on"),$(this).addClass("on");var b=JSON.parse(e.getOption("watchNotifyList")),c=$(this).attr("option");if("on"===c)b.indexOf(a)===-1&&b.push(a);else{var d=b.indexOf(a);d!==-1&&b.splice(d,1)}e.setOption("watchNotifyList",JSON.stringify(b))}),b();var j=JSON.parse(e.getOption("crx_update"));switch(j.version&&e.compareVersion(j.version,chrome.runtime.getManifest().version)>0&&($("#update").show(),$("#update .version").text(j.version),$("#update .date").text(d(j.update_time/1e3)),j.detail?$("#update .detail").text(j.detail):$("#update .detail").parent().hide(),$("#update .url").attr("href","https://bilihelper.guguke.net/"),$("#about #update p").addClass("highlight")),c("mod")){case"update":swal({title:"升级成功",text:"您已成功升级至哔哩哔哩助手版本 v"+chrome.runtime.getManifest().version+"！请参阅右侧有关扩展更新内容，再次感谢您对哔哩哔哩助手项目的支持。",type:"success",confirmButtonText:"好的",html:!0});break;case"install":swal({title:"安装成功",text:"感谢您安装哔哩哔哩助手版本 v"+chrome.runtime.getManifest().version+'！请根据您的需要在左侧更改扩展的选项，右侧为有关扩展的相关介绍和说明。使用此扩展前请您阅读相关<a href="http://addons-privacy.com/" target="_blank">使用协议和隐私策略</a>。',type:"success",confirmButtonText:"同意并开始使用扩展",html:!0},function(){});break;case"new":j.version&&swal({title:"发现新版本",text:"发现新版哔哩哔哩助手: v"+j.version+"<br/>您当前使用的版本是: v"+chrome.runtime.getManifest().version+"<br/>如果您不能通过 Google 自动更新扩展或者在使用上遇到严重的问题，建议您参阅右侧信息，手动更新。",type:"warning",confirmButtonText:"好的",cancelButtonText:"不再提醒",html:!0,showCancelButton:!0},function(a){!a&&e.setOption("versionNotify","off",!1)})}window.history.replaceState({},document.title,"/options.html")});