"use strict";var Live={setInterval:function(a){function b(b,c,d){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a,b,c){var d=setInterval(function(){a&&"function"==typeof b&&(b(),clearInterval(d))},c)}),set:function(a,b,c){if(window.localStorage&&a){var d=window.localStorage;d[a]||(d[a]=JSON.stringify({}));var e=JSON.parse(d[a]);void 0===c?d[a]="string"==typeof b?b.trim():JSON.stringify(b):(e[b]="string"==typeof c?c.trim():JSON.stringify(c),d[a]=JSON.stringify(e))}}};console.warn("%c弹幕监控脚本 插入成功㇏(°ω° )ノ♪~");var event=document.createEvent("Event");event.initEvent("sendMessage",!0,!0);var sendMessage=function(a){var b=JSON.stringify(a);Live.set("bilibili_helper_message",b),document.dispatchEvent(event)},options=document.getElementById("bilibiliHelperScript").getAttribute("options");if("{}"!==options&&(options=JSON.parse(options)),options.treasure&&Live.setInterval(window.refreshCaptcha,function(){window.refreshCaptcha=function(){$("#captchaImg").attr("src","http://live.bilibili.com/freeSilver/getCaptcha?ts="+Date.now())}},1e3),options.chat){var text="",sendDamu=function a(){if(text.length>0){var b=$(".color-select-panel").attr("data-dd"),c=$(".mode-select-panel").find("a.active").attr("class").split(" ",3)[1];window.LivePlayer.sendMsg(text.substr(0,options.chat.maxLength),b,options.chat.danmuMode[c]),text=text.substr(options.chat.maxLength),text.length>0&&setTimeout(function(){a()},4e3)}};$(".helper-send-btn").on("click",function(a){a.preventDefault(),""!==$(".helper-text-area").val()?(0===text.length?(text=$(".helper-text-area").val().trim(),$(".helper-text-area").val(""),sendDamu()):(text+=$(".helper-text-area").val(),$(".helper-text-area").val("")),$(".danmu-length-count").text("0 / 1 + 0")):window.liveToast($(".helper-send-btn"),"info","请输入弹幕后再发送~")})}options.watcher&&Live.setInterval(window.protocol,function(){Live.setInterval(window.protocol.SYS_MSG,function(){var a=window.protocol.SYS_MSG;window.protocol.SYS_MSG=function(b){a(b),sendMessage(b)}},500)},1e3);