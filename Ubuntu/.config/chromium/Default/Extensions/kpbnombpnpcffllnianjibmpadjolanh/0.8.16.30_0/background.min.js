"use strict";function removeExtensionParam(a){return a.replace(/platform=bilihelper&?/,"")}function getFileData(a,b,c){var d="GET";!c||c!=="POST".toLowerCase()&&c!=="GET".toLowerCase()||(d=c);var e=new XMLHttpRequest;e.open(d,a,!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status?"function"==typeof b&&b(e.responseText):4===e.readyState&&e.status>400&&"function"==typeof b&&b("{}")},e.send()}function compareVersion(a,b){if(a===b)return 0;for(var c=a.split("."),d=b.split("."),e=Math.min(c.length,d.length),f=0;f<e;f++){if(parseInt(c[f])>parseInt(d[f]))return 1;if(parseInt(c[f])<parseInt(d[f]))return-1}return c.length>d.length?1:c.length<d.length?-1:0}function postFileData(a,b,c){var d="",e=!1;Object.keys(b).forEach(function(a){e?d+="&":e=!0,d+=encodeURIComponent(a).replace(/%20/g,"+")+"="+encodeURIComponent(b[a]).replace(/%20/g,"+")});var f=new XMLHttpRequest;f.open("POST",a,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.onreadystatechange=function(){4===f.readyState&&200===f.status&&"function"==typeof c&&c(f.responseText)},f.send(d)}function searchBilibili(a){chrome.tabs.create({url:"http://www.bilibili.com/search?keyword="+a.selectionText})}function notifyAllTabs(a){chrome.windows.getAll({populate:!0},function(b){b.forEach(function(b){b.tabs.forEach(function(b){chrome.tabs.sendMessage(b.id,a)})})})}function updateAll(){notifyAllTabs({command:"update"})}function enableAll(){setOption("enabled",!0),updateAll()}function disableAll(){setOption("enabled",!1),updateAll()}function checkDynamic(){"on"===getOption("dynamic")&&hasLogin===!0&&getFileData("http://api.bilibili.com/x/feed/unread/count?type=0",function(a){var b=JSON.parse(a);"object"===("undefined"==typeof b?"undefined":_typeof(b))&&0===b.code&&"object"===_typeof(b.data)&&"number"==typeof b.data.all&&(b.data.all>0?(setOption("updates",b.data.all),chrome.browserAction.setBadgeText({text:getOption("updates")}),getFileData("http://api.bilibili.com/x/feed/pull?ps=1&type=0",function(a){var c=JSON.parse(a);if("object"===("undefined"==typeof c?"undefined":_typeof(c))&&0===c.code&&"object"===_typeof(c.data)&&"object"===_typeof(c.data.feeds)&&c.data.feeds.length>0){var d=c.data.feeds[0];if(d.ctime!==parseInt(getOption("lastDyn"))){notification&&chrome.notifications.clear("bh-"+notification,function(){}),notification=d.ctime;var e=chrome.i18n.getMessage("followingUpdateMessage").replace("%n",b.data.all).replace("%uploader",d.source.uname).replace("%title",d.addition.title),f=d.addition.pic?d.addition.pic:"imgs/icon-256.png";notificationAvid["bh-"+notification]=d.addition.aid,chrome.notifications.create("bh-"+notification,{type:"basic",iconUrl:f,title:chrome.i18n.getMessage("noticeficationTitle"),message:e,isClickable:!1,buttons:[{title:chrome.i18n.getMessage("notificationWatch")},{title:chrome.i18n.getMessage("notificationWatchLater")}]},function(){}),setOption("lastDyn",d.ctime)}}})):(setOption("updates",0),chrome.browserAction.setBadgeText({text:""})))})}function resolvePlaybackLink(a,b){if(!(a&&a.durl&&a.durl[0]&&a.durl[0].url))return"function"==typeof b&&b(a),!1;var c=removeExtensionParam(a.durl[0].url),d=new XMLHttpRequest,e=function g(){if(2===d.readyState){f||200===d.status||(f=!0,d.abort(),d=new XMLHttpRequest,d.open("GET",c,!0),d.onreadystatechange=g,d.send()),c=d.responseURL||c;var e=new URL(c).origin+"/*";videoPlaybackHosts.indexOf(e)<0&&(videoPlaybackHosts.push(e),resetVideoHostList()),a.durl[0].url=c,"function"==typeof b&&b(a),d.abort()}},f=!1;d.open("HEAD",c,!0),d.onreadystatechange=e,d.send()}function addWatchLater(a){watchLater=!0;var b=new XMLHttpRequest,c="https://api.bilibili.com/x/v2/history/toview/add",d=function f(){if(2===b.readyState){e||200===b.status||(e=!0,b.abort(),b=new XMLHttpRequest,b.open("POST",c,!0),b.onreadystatechange=f,b.send("aid="+a+"&jsonp=jsonp&csrf="+csrfCode));var d=new URL(c).origin+"/*";videoPlaybackHosts.indexOf(d)<0&&(videoPlaybackHosts.push(d),resetVideoHostList()),b.abort()}},e=!1;b.open("POST",c,!0),b.onreadystatechange=d,b.send("aid="+a+"&jsonp=jsonp&csrf="+csrfCode)}function getVideoInfo(a,b,c){b=parseInt(b);var d=parseInt((new Date).getTime()/1e3);return(isNaN(b)||b<1)&&(b=1),"undefined"!=typeof viCache[a+"-"+b]&&d-viCache[a+"-"+b].ts<=3600?(c(viCache[a+"-"+b]),!0):(resetVideoHostList(),getFileData("http://api.bilibili.com/view?type=json&appkey=8e9fc618fbd41e28&id="+a+"&page="+b+"&batch=true",function(e){if(e=JSON.parse(e),"undefined"!=typeof e.code&&e.code===-503)setTimeout(function(){getVideoInfo(a,b,c)},1e3);else{if("object"===_typeof(e.list)){e.pages=e.list.length;for(var f=0;f<e.pages;f++)if(e.list[f].page===b){e.cid=e.list[f].cid;break}}"number"==typeof e.cid?(viCache[a+"-"+b]={mid:e.mid,tid:e.tid,cid:e.cid,pic:e.pic,pages:e.pages,title:e.title,list:e.list,sp_title:e.sp_title,spid:e.spid,season_id:e.season_id,created_at:e.created_at,description:e.description,tag:e.tag,ts:d,bangumi:!1},"object"===_typeof(e.bangumi)?getFileData("http://api.bilibili.cn/sp?spid="+e.spid,function(d){d=JSON.parse(d),1===d.isbangumi&&(viCache[a+"-"+b].bangumi={cover:d.cover,desc:d.description}),c(viCache[a+"-"+b])}):c(viCache[a+"-"+b])):c(e)}}),!0)}function checkSecurePlayer(){var a=new XMLHttpRequest;a.open("HEAD","https://static-s.bilibili.com/play.swf",!0),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&(secureAvailable="application/x-shockwave-flash"===a.getResponseHeader("Content-Type"))},a.send()}function setTreasure(a){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)({}).hasOwnProperty.call(a,b)&&(Live.treasure[b]=a[b])}function setWatcherRoom(a){if("[object Object]"===Object.prototype.toString.call(a))for(var b in a)({}).hasOwnProperty.call(a,b)&&(Live.watcherRoom[b]=a[b])}function setFavourite(a){return Live.favouritesIdList.indexOf(a.roomId)===-1&&(Live.favouritesIdList.push(a.roomId),Live.favouritesList[a.roomId]=a,Live.set("favouritesIdList",Live.favouritesIdList),Live.set("favouritesList",Live.favouritesList),!0)}function setNotFavourite(a){var b=Live.favouritesIdList.indexOf(a);return b!==-1&&(Live.favouritesIdList.splice(b,1),delete Live.favouritesList[a],Live.set("favouritesIdList",Live.favouritesIdList),Live.set("favouritesList",Live.favouritesList),!0)}function checkVersion(){var a=getOption("versionNotify");"on"===a&&getFileData("https://bilihelper.guguke.net/version.json?v="+encodeURIComponent(chrome.runtime.getManifest().version),function(a){try{a=JSON.parse(a),compareVersion(a.version,chrome.runtime.getManifest().version)>0&&(setOption("crx_update",JSON.stringify(a)),(!localeAcquired||1===locale||(new Date).getTime()-a.update_time>2592e5)&&(updateNotified=!0,chrome.tabs.create({url:chrome.extension.getURL("options.html?mod=new")})))}catch(b){console.error("Failed to check version",b)}})}function receivedHeaderModifier(a){var b=!1;return a.responseHeaders.forEach(function(a){"access-control-allow-origin"===a.name.toLowerCase()&&(b=!0)}),!b&&watchLater?(a.responseHeaders.push({name:"Access-Control-Allow-Credentials",value:"true"}),a.responseHeaders.push({name:"Access-Control-Allow-Methods",value:"POST, GET"}),a.responseHeaders.push({name:"Access-Control-Allow-Origin",value:"http://www.bilibili.com"}),watchLater=!1):b||bangumi?b||a.responseHeaders.push({name:"Access-Control-Allow-Origin",value:"http://bangumi.bilibili.com"}):a.responseHeaders.push({name:"Access-Control-Allow-Origin",value:"http://www.bilibili.com"}),{responseHeaders:a.responseHeaders}}function resetVideoHostList(){chrome.webRequest.onHeadersReceived.hasListener(receivedHeaderModifier)&&chrome.webRequest.onHeadersReceived.removeListener(receivedHeaderModifier),chrome.webRequest.onHeadersReceived.addListener(receivedHeaderModifier,{urls:videoPlaybackHosts},["responseHeaders","blocking"])}function getCookie(a){var b=void 0,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}function each(a,b){if(b)if(a instanceof Array)for(var c=0,d=a.length;c<d&&b.call(a[c],c)!==!1;c++);else if("object"===("undefined"==typeof a?"undefined":_typeof(a))){var e=null;for(e in a)if(b.call(a[e],e)===!1)break}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},notification=!1,notificationAvid={},playerTabs={},viCache={},locale=0,localeAcquired=!1,localeTimeout=null,secureAvailable=!1,updateNotified=!1,videoPlaybackHosts=["http://*.hdslb.com/*","http://*.acgvideo.com/*"],Live={},bangumi=!1,csrfCode=void 0,watchLater=!1,hasLogin=!1;Live.set=function(a,b,c){if(window.localStorage&&a){var d=window.localStorage;d[a]||(d[a]=JSON.stringify({}));var e=JSON.parse(d[a]);void 0===c?d[a]="string"==typeof b?b.trim():JSON.stringify(b):(e[b]="string"==typeof c?c.trim():JSON.stringify(c),d[a]=JSON.stringify(e))}},Live.get=function(a,b,c){if(window.localStorage&&a){if(!window.localStorage[a]){var d=void 0===c?{}:c;void 0!==b&&void 0!==c&&(d[b]=c),window.localStorage[a]=JSON.stringify(d)}var e=JSON.parse(window.localStorage[a]);return void 0===b?e:("true"!==e[b]&&"false"!==e[b]||(e[b]=JSON.parse(e[b])),e[b])}},Live.del=function(a,b){if(window.localStorage&&void 0!==a&&void 0!==window.localStorage[a]){if(void 0===b)return void window.localStorage.removeItem(a);var c=JSON.parse(window.localStorage[a]);delete c[b],window.localStorage[a]=JSON.stringify(c)}},Live.notisesIdList={},Live.favouritesIdList=Live.get("favouritesIdList",void 0,[]),Live.favouritesList=Live.get("favouritesList",void 0,{}),URL.prototype.__defineGetter__("query",function(){var a=this.search.substr(1).split("&"),b={};return a.forEach(function(a,c,d){var e=d[c].split("=");b[e[0]]=e[1]}),b}),chrome.cookies.get({url:"https://www.bilibili.com",name:"bili_jct"},function(a){a&&(csrfCode=a.value,hasLogin=!0)}),"function"==typeof chrome.runtime.setUninstallURL&&chrome.runtime.setUninstallURL("https://extlabs.io/analytics/uninstall/?uid=178&pid=264&finish_url=https%3A%2F%2Fbilihelper.guguke.net%2F%3Funinstall%26version%3D"+chrome.runtime.getManifest().version),Live.treasure={},Live.watcherRoom={},Live.tvs={},Live.tvNotification={},chrome.runtime.onConnect.addListener(function(a){Live.treasure.port=a}),chrome.runtime.onMessage.addListener(function(a,b,c){switch(a.command){case"init":return c({autowide:getOption("autowide"),version:version,macplayer:getOption("macplayer"),autooffset:getOption("autooffset")}),!0;case"cidHack":return!isNaN(a.cid)&&(playerTabs[b.tab.id]=a.cid,c(),!0);case"getOption":return c({value:getOption(a.key)}),!0;case"getAd":return c({value:getOption("ad")}),!0;case"setOption":return setOption(a.key,a.value),c({value:getOption(a.key)}),!0;case"getTreasure":return c({data:Live.treasure}),!0;case"setTreasure":return setTreasure(a.data),c({data:Live.treasure}),!0;case"setCurrentTreasure":return void 0!==a.data.time_end&&a.data.time_end!==Live.treasure.time_end&&Live.treasure.port&&(setTreasure(a.data),Live.treasure.port.postMessage({command:"updateCurrentTreasure",data:{minute:a.data.minute,silver:a.data.silver,time_end:a.data.time_end,time_start:a.data.time_start}})),!0;case"getCurrentTreasure":return c({data:{minute:Live.treasure.minute,silver:Live.treasure.silver,time_end:Live.treasure.time_end,time_start:Live.treasure.time_start}}),!0;case"delTreasure":return c({data:Live.treasure={}}),!0;case"getWatcherRoom":return c({data:Live.watcherRoom}),!0;case"setWatcherRoom":return setWatcherRoom(a.data),c({data:Live.watcherRoom}),!0;case"delWatcherRoom":return c({data:Live.watcherRoom={}}),!0;case"setFavourite":return c({data:setFavourite(a.upInfo)}),!0;case"setNotFavourite":return c({data:setNotFavourite(a.id)}),!0;case"getFavourite":return c({data:Live.get("favouritesIdList")}),!0;case"enableAll":return enableAll(),c({result:"ok"}),!0;case"disableAll":return disableAll(),c({result:"ok"}),!0;case"getCSS":return c("true"===getOption("enabled")||"keep"!==getOption("ad")?{result:"ok",css:getCSS(a.url)}:{result:"disabled"}),!0;case"getVideoInfo":return getVideoInfo(a.avid,a.pg,function(a){c({videoInfo:a})}),!0;case"getDownloadLink":var d={download:"http://interface.bilibili.com/playurl?platform=bilihelper&otype=json&appkey=95acd7f6cc3392f3&cid="+a.cid+"&quality="+getOption("dlquality"),playback:"http://interface.bilibili.com/playurl?platform=bilihelper&otype=json&appkey=95acd7f6cc3392f3&cid="+a.cid+"&quality=2&type=mp4"};return getFileData(d.download,function(a){a=JSON.parse(a),"mp4"===getOption("dlquality")?a&&resolvePlaybackLink(a,function(b){c({download:a,playback:b,dlquality:getOption("dlquality"),rel_search:getOption("rel_search")})}):getFileData(d.playback,function(b){b=JSON.parse(b),resolvePlaybackLink(b,function(b){c({download:a,playback:b,dlquality:getOption("dlquality"),rel_search:getOption("rel_search")})})})}),!0;case"getMyInfo":return getFileData("http://api.bilibili.com/myinfo",function(a){a=JSON.parse(a),void 0===_typeof(a.code)&&(a.code=200),c({code:a.code||200,myinfo:a})}),!0;case"getBangumiInfo":var e=a.episodeId;return getFileData("http://bangumi.bilibili.com/web_api/episode/"+e+".json",function(a){a=JSON.parse(a),void 0===_typeof(a.code)&&(a.code=200),a=a.result,c({videoInfo:a.currentEpisode})}),!0;case"searchVideo":var f=a.keyword;return getFileData("http://api.bilibili.com/search?type=json&appkey=8e9fc618fbd41e28&keyword="+encodeURIComponent(f)+"&page=1&order=ranklevel",function(a){a=JSON.parse(a),c(0===a.code?{status:"ok",result:a.result[0]}:{status:"error",code:a.code,error:a.error})}),!0;case"checkComment":return getFileData("http://www.bilibili.com/feedback/arc-"+a.avid+"-1.html",function(a){var b=a.indexOf('<div class="no_more">');c(b>=0?{banned:!0}:{banned:!1})}),!0;case"savePlayerConfig":return c({result:setOption("playerConfig",JSON.stringify(a.config))}),!0;case"sendComment":var g=["正常","选择的弹幕模式错误","用户被禁止","系统禁止","投稿不存在","UP主禁止","权限有误","视频未审核/未发布","禁止游客弹幕"];return a.comment.cid=a.cid,postFileData("http://interface.bilibili.com/dmpost?cid="+a.cid+"&aid="+a.avid+"&pid="+a.page,a.comment,function(a){a=parseInt(a),c(a<0?{result:!1,error:g[-a]}:{result:!0,id:a})}),!0;case"tvNotification":var h=a.data,i=h.roomId;return Live.tvNotification[i]=!0,chrome.notifications.create(i,{type:"basic",iconUrl:"http://static.hdslb.com/live-static/live-room/images/gift-section/gift-25.gif",title:"小电视抽奖提示",message:"直播间【"+i+"】正在进行小电视抽奖",isClickable:!0,buttons:[{title:chrome.i18n.getMessage("notificationGetTv")}]},function(a){setTimeout(function(){chrome.notifications.clear(a)},1e4)}),!0;case"getTVReward":var j="",k="很遗憾，此次您没有中奖",l=a.data;return j+=1===l.rewardId?"大号小电视"+l.rewardNum+"个":2===l.rewardId?"蓝白胖次道具"+l.rewardNum+"个":3===l.rewardId?"B坷垃"+l.rewardNum+"个":4===l.rewardId?"喵娘"+l.rewardNum+"个":5===l.rewardId?"便当"+l.rewardNum+"个":6===l.rewardId?"银瓜子"+l.rewardNum+"个":7===l.rewardId?"辣条"+l.rewardNum+"个":k,l.rewardNum>0?1===l.rewardId||l.isWin?chrome.notifications.create("getTV",{type:"basic",iconUrl:"http://static.hdslb.com/live-static/live-room/images/gift-section/gift-25.png",title:"小电视抽奖结果",message:"恭喜你抽到了小电视，请尽快前往填写收货地址，不填视为放弃",isClickable:!1,buttons:[{title:chrome.i18n.getMessage("notificationGetTv")}]},function(a){setTimeout(function(){chrome.notifications.clear(a)},1e4)}):chrome.notifications.create("getTV",{type:"basic",iconUrl:"http://static.hdslb.com/live-static/live-room/images/gift-section/gift-25.png",title:"小电视抽奖结果",isClickable:!1,message:"在直播间:"+l.roomId+" 抽到"+j},function(a){setTimeout(function(){chrome.notifications.clear(a)},1e4)}):chrome.notifications.create("getTV",{type:"basic",iconUrl:"http://static.hdslb.com/live-static/live-room/images/gift-section/gift-25.png",title:"直播间:"+l.roomId,message:j,isClickable:!1},function(a){setTimeout(function(){chrome.notifications.clear(a)},1e4)}),!0;case"requestForDownload":return chrome.downloads.download({saveAs:!0,url:a.data?URL.createObjectURL(new Blob([a.data],{type:"application/octet-stream"})):a.url,filename:"Bilibili/"+a.filename}),!0;case"callBilibiliMac":return postFileData("http://localhost:23330/rpc",a.data,function(){c(!0)}),!0;case"sendcsrfCode":return csrfCode=a.csrfCode,!0;default:return c({result:"unknown"}),!1}}),null===localStorage.getItem("enabled")&&enableAll(),"on"===getOption("contextmenu")&&chrome.contextMenus.create({title:chrome.i18n.getMessage("searchBili"),contexts:["selection"],onclick:searchBilibili}),checkDynamic(),window.navigator.userAgent.indexOf("Windows")<0&&checkSecurePlayer(),chrome.alarms.create("checkDynamic",{periodInMinutes:1}),"on"===getOption("versionNotify")&&chrome.alarms.create("checkVersion",{periodInMinutes:60}),chrome.runtime.onInstalled.addListener(function(a){setOption("version",chrome.runtime.getManifest().version),"install"===a.reason?chrome.tabs.create({url:chrome.extension.getURL("options.html?mod=install")}):"update"===a.reason&&compareVersion(getOption("version"),chrome.runtime.getManifest().version)<0&&chrome.notifications.create("bh-update",{type:"basic",iconUrl:"imgs/icon-256.png",title:chrome.i18n.getMessage("noticeficationTitle"),message:chrome.i18n.getMessage("noticeficationExtensionUpdate").replace("%v",chrome.runtime.getManifest().version),isClickable:!1,buttons:[{title:chrome.i18n.getMessage("noticeficationNewFeatures")}]},function(){})}),chrome.alarms.onAlarm.addListener(function(a){switch(a.name){case"checkDynamic":return checkDynamic(),!0;case"checkVersion":return updateNotified||checkVersion(),!0;case"getLocale":return localeAcquired||clearTimeout(localeTimeout),!0;default:return!1}}),chrome.notifications.onButtonClicked.addListener(function(a,b){void 0!==Live.tvNotification[a]&&chrome.tabs.create({url:"http://live.bilibili.com/"+a}),void 0!==Live.notisesIdList[a]?0===b?chrome.tabs.create({url:Live.notisesIdList[a].link}):1===b&&chrome.tabs.create({url:"http://live.bilibili.com/i/following"}):"bh-update"===a?chrome.tabs.create({url:chrome.extension.getURL("options.html?mod=update")}):"getTV"===a?chrome.tabs.create({url:"http://live.bilibili.com/i/awards"}):0===b&&notificationAvid[a]?chrome.tabs.create({url:"http://www.bilibili.com/video/av"+notificationAvid[a]}):1===b&&notificationAvid[a]&&(resetVideoHostList(),addWatchLater(notificationAvid[a]))}),chrome.webRequest.onBeforeRequest.addListener(function(a){chrome.tabs.sendMessage(a.tabId,{command:"error"})},{urls:["http://comment.bilibili.com/1272.xml"]}),chrome.webRequest.onBeforeRequest.addListener(function(){return secureAvailable?{redirectUrl:"https://static-s.bilibili.com/play.swf"}:{}},{urls:["http://static.hdslb.com/play.swf"]},["blocking"]),chrome.webRequest.onHeadersReceived.addListener(function(a){var b=a.responseHeaders;if(0===a.statusLine.indexOf("HTTP/1.1 302")&&"on"===getOption("replace"))for(var c=0;c<b.length;c++)"location"===b[c].name.toLowerCase()&&b.splice(c,1,{name:"Set-Cookie",value:"redirectUrl="+encodeURIComponent(b[c].value)});return{responseHeaders:b}},{urls:["http://www.bilibili.com/video/av*","http://bangumi.bilibili.com/anime/v/*","http://api.bilibili.com/x/v2/history/toview/add"]},["responseHeaders","blocking"]),Live.notise={page:1,userMode:function(){return getCookie("DedeUserID")}(),hasMore:!1,list:[],count:0,intervalNum:void 0,heart:{},roomIdList:{},cacheList:{},getList:function(a){var b="http://live.bilibili.com/feed/getList/"+Live.notise.page,c=function(b){b=b.substr(1,b.length-3),b=JSON.parse(b);var c={},d=[];if(each(b.data.list,function(a){c[b.data.list[a].roomid]=b.data.list[a]}),1===Live.notise.page?Live.notise.cacheList=c:each(c,function(a){Live.notise.cacheList[a]=c[a]}),Live.notise.hasMore=b.data.count>10&&10===b.data.list.length&&Live.notise.userMode,!Live.notise.hasMore||a.has_new){for(var e in Live.notise.cacheList)void 0===Live.notise.roomIdList[e]&&d.push(Live.notise.cacheList[e]);d.length&&each(d,function(a){if(Live.favouritesIdList.indexOf(parseInt(d[a].roomid))!==-1){var b=d[a];chrome.notifications.create(b.roomid,{type:"basic",iconUrl:b.face,title:b.nickname+chrome.i18n.getMessage("notificationLiveOn"),message:b.roomname,isClickable:!0,buttons:[{title:chrome.i18n.getMessage("notificationWatch")}]},function(a){Live.notisesIdList[a]=b,setTimeout(function(){chrome.notifications.clear(a),delete Live.notisesIdList[a]},1e4)})}}),Live.notise.roomIdList=Live.notise.cacheList,Live.notise.cacheList={}}},d=Live.notise.userMode?"POST":"GET";getFileData(b,c,d)},heartBeat:function(){getFileData("http://live.bilibili.com/feed/heartBeat/heartBeat",function(a){a=JSON.parse(a),Live.notise["do"](a)},"POST")},"do":function(a){a.data&&(Live.notise.feedMode=a.data.open,0===a.code?(Live.notise.count=a.data.count,a.data.open&&a.data.has_new&&(Live.notise.count=0,Live.notise.page=1,Live.notise.open=!0,Live.notise.getList(a.data))):clearInterval(Live.notise.intervalNum))},init:function(){Live.notise.count=0,Live.notise.hasMore=!1,Live.notise.list=[],Live.notise.count=0,Live.notise.intervalNum=void 0,Live.notise.heart={},Live.notise.roomIdList={},Live.notise.cacheList={},Live.notise.heartBeat(),Live.notise.getList(),Live.notise.intervalNum=setInterval(function(){Live.notise.heartBeat(),Live.notise.hasMore&&(Live.notise.page++,Live.notise.getList())},3e4)}},"on"===getOption("liveNotification")&&Live.notise.init(),chrome.runtime.onConnect.addListener(function(a){a.onMessage.addListener(function(a){if(!a.cmd)return!1})});