"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(){if("live.bilibili.com"===location.hostname){if(!store.enabled)return;store["delete"]=function(a,b){if(void 0!==a){var c=store.get(a);void 0!==c&&(void 0!==b&&null!==b?"string"!=typeof b&&"number"!=typeof b||(c[b]&&delete c[b],store.set(a,c)):store.remove(a))}};var b={scriptOptions:{},hasInit:!1,giftList:{},mobileVerified:0,protocol:location.protocol};b.addScriptByFile=function(a,b){var c=document.createElement("script");c.id="bilibiliHelperScript",c.src=chrome.extension.getURL(a),"object"===("undefined"==typeof b?"undefined":_typeof(b))&&c.setAttribute("options",JSON.stringify(b)),document.body.appendChild(c)},b.addScriptByText=function(a){var b=document.createElement("script");b.innerHTML=a,document.body.appendChild(b)},b.getDateDiff=function(a,b){var c=new Date(Date.parse(a.replace(/-/g,"/"))).getTime(),d=new Date(Date.parse(b.replace(/-/g,"/"))).getTime(),e=Math.abs(c-d)/864e5;return e},b.getRoomHTML=function(a){return $.get(b.protocol+"//live.bilibili.com/"+a).promise()},b.getRoomIdByUrl=function(a,c){var d=store.get("bilibili_helper_live_roomId")[a];void 0!=d?c(d):b.getRoomHTML(a).done(function(b){var d=new RegExp("var ROOMID = ([\\d]+)"),e=d.exec(b)[1];if(e){var f=void 0;(f=store.get("bilibili_helper_live_roomId"))[a]=e,store.set("bilibili_helper_live_roomId",f),"function"==typeof c&&c(e)}}).fail(function(d){404!=d.status&&b.getRoomIdByUrl(a,c)})},b.getUser=function(){return $.getJSON(b.protocol+"//live.bilibili.com/user/getuserinfo").promise()},b.getMedalList=function(){return $.getJSON(b.protocol+"//live.bilibili.com/i/ajaxGetMyMedalList").promise()},b.eval=function(a){var b=Function;return new b("return "+a)()},b.each=function(a,b){if(b)if(a instanceof Array)for(var c=0,d=a.length;c<d&&b.call(a[c],c)!==!1;c++);else if("object"===("undefined"==typeof a?"undefined":_typeof(a))){var e=null;for(e in a)if(b.call(a[e],e)===!1)break}},b.getCookie=function(a){var b=void 0,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null},b.setCookie=function(a,b,c){c=c||0;var d="";if(0!=c){var e=new Date;e.setTime(e.getTime()+1e3*c),d="; expires="+e.toGMTString()}document.cookie=a+"="+escape(b)+d+"; path=/"},b.liveQuickLogin=function(){function a(){throw window.biliQuickLogin?(window.biliQuickLogin(function(){window.location.reload()}),"Bilibili Live: 您没登陆，想干撒子？~~ -_-"):"Bilibili Live: 快速登录脚本未正确载入."}if(!b.getCookie("DedeUserID")&&!b.getCookie("LIVE_LOGIN_DATA"))try{window.biliQuickLogin?a():$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(b,c){"success"===c&&a()})}catch(c){throw new Error(c)}},b.getRoomId=function(){return store.get("bilibili_helper_live_roomId")[location.pathname.substr(1)]},b.getRoomInfo=function(){return $.getJSON(b.protocol+"//live.bilibili.com/live/getInfo?roomid="+b.roomId).promise()},b.numFormat=function(a){var b=a;return a>=1e4&&(b=(a/1e4).toFixed(1)+"万"),b},b.rgb2hex=function(a){function b(a,b){for(var c=a.toString(16);c.length<b;)c="0"+c;return c}if("#"===a.charAt(0))return a;var c=a.split(/\D+/),d=65536*Number(c[1])+256*Number(c[2])+Number(c[3]);return"#"+b(d,6)},b.getDomType=function(a){var b=Object.prototype.toString.call(a),c=/HTML.*.Element/;return"[object Object]"===b&&a.jquery?"jQuery Object":"[object Object]"===b?"Object":"[object Number]"===b?"Number":"[object String]"===b?"String":"[object Array]"===b?"Array":"[object Boolean]"===b?"Boolean":"[object Function]"===b?"Function":"[object Null]"===b?"null":"[object Undefined]"===b?"undefined":b.match(c)?"HTML Element":"[object HTMLCollection]"===b?"HTML Elements Collection":null},b.randomEmoji={list:{happy:["(｀･ω･´)","=‿=✧","●ω●","(/ ▽ \\)","(=・ω・=)","(●'◡'●)ﾉ♥","<(▰˘◡˘▰)>","(⁄ ⁄•⁄ω⁄•⁄ ⁄)","(ง,,• ᴗ •,,)ง ✧"],shock:[",,Ծ‸Ծ,,","(｀･д･´)","Σ( ° △ °|||)︴","┌( ಠ_ಠ)┘","(ﾟДﾟ≡ﾟдﾟ)!?"],sad:["∑(っ °Д °;)っ","＞︿＜","＞△＜","●︿●","(´；ω；`)"],helpless:["◐▽◑","ʅ（´◔౪◔）ʃ","_(:3 」∠)_","_(┐「ε:)_","(/・ω・＼)","(°▽°)ﾉ"]},happy:function(){return b.randomEmoji.list.happy[Math.floor(Math.random()*b.randomEmoji.list.happy.length)]},sad:function(){return b.randomEmoji.list.sad[Math.floor(Math.random()*b.randomEmoji.list.sad.length)]},shock:function(){return b.randomEmoji.list.shock[Math.floor(Math.random()*b.randomEmoji.list.shock.length)]},helpless:function(){return b.randomEmoji.list.helpless[Math.floor(Math.random()*b.randomEmoji.list.helpless.length)]}},b.countdown=function(a){if(!(this instanceof b.countdown))return new b.countdown(a);var c=new Date,d=a.endTime;if(!d||!(d instanceof Date)||d.getTime()<=c.getTime())return void console.error("倒计时时间设置错误");var e=setInterval(function(){var f=d.getTime()-c.getTime(),g=Math.floor(f/60/1e3),h=f-60*g*1e3,i=Math.floor(h/1e3);g=g<10?"0"+g:g,i=i<10?"0"+i:i;var j=g+":"+i;return"jQuery Object"===b.getDomType(a.element)?a.element.html(j):a.element.innerHTML=j,"00"===g&&"00"===i?(clearInterval(e),void(a.callback&&a.callback())):void d.setSeconds(d.getSeconds()-1)},1e3);this.countDown=e},b.countdown.prototype.clearCountdown=function(){clearInterval(this.countDown)},b.console={option:{display:{danmu:!1,tv_end:!1,gift:!1,system:!1,tv:!1,sys_gift:!0}},watcher:function(a){console.warn("%c监控:"+a,"color:#FFFFFF;background-color:#4fc1e9;padding:5px;border-radius:7px;line-height:30px;")},info:function(a,c){if("danmu"===a&&b.console.option.display.danmu){var d=c.info[1],e=c.info[2][0],f=c.info[2][1],g=c.info[4][0],h=c.info[4][1];console.warn("%c(UL:"+g+")"+e+"-"+f+":"+d+" 排名:"+h,"color:#FFFFFF;background-color:#646c7a;padding:5px;border-radius:7px;line-height:30px;")}else if("system"===a&&b.console.option.display.system){var i=c.msg,j=c.url;console.warn("%c系统通告:"+i+" 地址:"+j,"color:#FFFFFF;background-color:#e74e8f;padding:5px;border-radius:7px;line-height:30px;")}else if("tv_end"===a&&b.console.option.display.tv_end)console.warn(c);else if("gift"===a&&b.console.option.display.gift){var k=c.data.giftName,l=c.data.num,m=c.data.uname;console.warn("%c喂食:"+k+" x"+l+" 用户名:"+m,"color:#FFFFFF;background-color:#ff8e29;padding:5px;border-radius:7px;line-height:30px;")}else"sys_gift"===a&&b.console.option.display.sys_gift&&console.warn("%c系统通告:"+c.tips+" 地址:"+c.url,"color:#FFFFFF;background-color:#e74e8f;padding:5px;border-radius:7px;line-height:30px;")}},b.createPanel=function(a,b,c,d,e,f){var g=void 0,h=void 0;switch(c){case"click":g=c,h=c;break;case"mouseenter":case"hover":case"mouseover":g="mouseenter",h="mouseleave"}var i=$("<div />").addClass("live-hover-panel arrow-top "+d).attr("id",e);return a.append(b,i),b.off(g).on(g,function(a){function b(a){a.stopPropagation();var c=a&&(a.target||a.srcElement);$(c).hasClass(d)||$(c).parents("."+d).length||(i.addClass("out"),setTimeout(function(){$(window).off(g,b),i.removeClass("out").removeClass("show").css("display","")},300))}return a.stopPropagation(),$(window).click(),i.hasClass("show")?void("function"==typeof $(window)[h]&&$(window)[h]()):(i.addClass("show"),setTimeout(function(){$(window).off(h).on(h,b)},1),void("function"==typeof f&&f()))}),i},b.liveToast=function(c,d,e){function f(a){var b=a.offsetLeft;return null!==a.offsetParent?b+=f(a.offsetParent):void 0,b}function g(a){var b=a.offsetTop;return null!==a.offsetParent?b+=g(a.offsetParent):void 0,b}var h=d||"info";if("success"===h||"caution"===h||"error"===h||"info"===h){var i=document.createDocumentFragment(),j=document.createElement("div");j.innerHTML="<i class='toast-icon info'></i><span class='toast-text'>"+e+b.randomEmoji.helpless()+"</span>",j.className="live-toast "+h;var k=null;switch(b.getDomType(c)){case"HTML Element":k=c;break;case"jQuery Object":k=c[0];break;default:throw new Error(a.consoleText.error+"在使用 Live Toast 时请传入正确的原生 Dom 对象或节点的 jQuery 对象.")}var l={width:$(k).width(),height:$(k).height()},m=f(k),n=g(k);$(j).css({left:m+l.width});var o=0;o=document.body.scrollTop,$(j).css({top:n+l.height}),setTimeout(function(){$(j).addClass("out"),setTimeout(function(){$(j).remove(),i=j=k=l=m=n=o=null},400)},2e3),i.appendChild(j),document.body.appendChild(i);var p=$(window).width(),q=j.offsetWidth,r=j.offsetLeft;0>p-q-r&&$(j).css({left:p-q-10}),p=q=r=null}},b.doSign={getSignInfo:function(){return $.getJSON(b.protocol+"//live.bilibili.com/sign/GetSignInfo").promise()},init:function(){chrome.runtime.sendMessage({command:"getOption",key:"doSign"},function(a){if("on"===a.value){var c=store.get("bilibili_helper_userInfo").username,d=void 0;(d={})[c]={today:!1,date:void 0},store.set("bilibili_helper_doSign",d),b.doSign.getSignInfo().done(function(a){if(0===a.code&&0===a.data.status)b.doSign.sign(),setInterval(b.doSign.sign,6e4);else if(0===a.code&&1===a.data.status){var c=store.get("bilibili_helper_userInfo").username,d=void 0;(d=store.get("bilibili_helper_doSign"))[c]={today:!0,date:(new Date).getDate()},store.set("bilibili_helper_doSign",d)}})}})},sign:function(){var a=(new Date).getDate(),c=store.get("bilibili_helper_userInfo").username;store.get("bilibili_helper_doSign")[c].today&&store.get("bilibili_helper_doSign")[c].date==a||$.get("/sign/doSign",function(d){var e=JSON.parse(d),f=void 0;if(0===e.code){f=new Notification("签到成功",{body:"您获得了"+e.data.text,icon:b.protocol+"//static.hdslb.com/live-static/images/7.png"});var g;(g=store.get("bilibili_helper_doSign"))[c]={today:!0,date:a},store.set("bilibili_helper_doSign",g),setTimeout(function(){f.close()},1e4);var h=$(".body-container").find(".room-left-sidebar .sign-and-mission .sign-up-btn .dp-inline-block span");$(h[0]).hide(),$(h[1]).show()}else if(e.code===-500){f=new Notification(e.msg,{body:"不能重复签到",icon:b.protocol+"//static.hdslb.com/live-static/live-room/images/gift-section/gift-1.gif"});var g;(g=store.get("bilibili_helper_doSign"))[c]={today:!0,date:a},store.set("bilibili_helper_doSign",g),setTimeout(function(){f.close()},1e4)}else f=new Notification(e.msg,{body:"",icon:b.protocol+"//static.hdslb.com/live-static/live-room/images/gift-section/gift-1.gif"}),setTimeout(function(){f.close()},1e4)})}},b.Queue=function(a){var c={};return c.id=(new Date).getTime(),c.which=a,c.total=0,c.run=[],c.wait=[],c.error=[],c.success=[],c.cancel=[],c.add=function(a,b){b=void 0===b?"wait":b,c[b].push(a)},c.empty=function(){$("#quiz_helper").find(c.which+"-box *").addClass("hide"),c.run=[],c.wait=[],c.error=[],c.cancel=[],c.success=[]},c.remove=function(a){var b=c[a.state].indexOf(a);b!=-1&&(c[a.state].splice(b,1),a.destory())},c.pushQueue=function(a,b){if(a.state!=b)if(b=void 0===b?"wait":b,c.remove(a),"run"!=b)"success"===b&&(c.total+=a.number),a.state=b,c.add(a,b),a.create_dom().updateMenu();else{if(a.state="run",c.run.length>0){var d=c.run.shift();d.wait().updateMenu(),c.wait.unshift(d)}c.run.push(a),a.create_dom(!0).updateMenu()}},c.updateTotal=function(){b.bet[c.which+"_sum_number"].text(c.total)},c},b.Appoint=function(a,c,d,e){var f={};return f.id=(new Date).getTime(),f.which=a,f.rate=c,f.number=d,f.state=void 0===e?"wait":e,f.emit=function(a,c){return f.state=void 0===c?f.state:c,f.create_dom(),b.bet[a+"_box"].append(f.dom),b.bet[a+"_queue"].pushQueue(f),b.bet.checkQueue(),f},f.create_dom=function(d){if(void 0===f.dom){var e=$("<span>").addClass("rate").text(c),g=$("<h4>").addClass("number").text(b.numFormat(f.number));f.menu=$("<div>").addClass("menu"),f.dom=$("<div>").addClass("count").addClass(f.state).attr({id:f.id,rate:c,number:f.number}).append(g,e,$("<a>").addClass("close"),f.menu),f.updateMenu();var h=b.bet[a+"_box"].children(".success:last");d?0!=h.length?h.after(f.dom):b.bet[a+"_box"].prepend(f.dom):b.bet[a+"_box"].append(f.dom)}return f},f.updateMenu=function(){return f.menu.empty(),f.menu_delete=$('<span class="delete"></span>').off("click").click(function(){b.bet[f.which+"_queue"].remove(f)}),f.menu_reset=$('<span class="reset"></span>').off("click").click(function(){b.bet[f.which+"_queue"].pushQueue(f,"wait")}),f.menu_run=$('<span class="run"></span>').off("click").click(function(){b.bet[f.which+"_queue"].pushQueue(f,"run")}),"run"===f.state||"success"===f.state||"error"===f.state||"cancel"===f.state?f.menu.append(f.menu_reset,f.menu_delete):"wait"===f.state&&f.menu.append(f.menu_run,f.menu_delete),f},f.run=function(a){if(!a)return!1;f.state="run",f.dom.removeClass("cancel wait error success"),f.dom.hasClass("run")||f.dom.addClass("run");var c="blue"===f.which?"a":"b",d=a.silver[c].id,e=a.silver[c].times;return b.bet.stop&&clearInterval(store.get("bilibili_helper_quiz_bet")[b.roomId]),e>=f.rate&&$.ajax({url:b.protocol+"//live.bilibili.com/bet/addBettor",type:"POST",dataType:"json",data:{bankerId:d,amount:f.number,token:b.getCookie("LIVE_LOGIN_DATA")},complete:function(a){var b=JSON.parse(a.responseText);b.code===-400?"手慢了,剩余可购数量不足！"===b.msg||f.error(b):"ok"===b.msg&&f.success()}}),f},f.error=function(a){return!!a&&(f.state="error",console.error(f.id+":"+a.msg),f.dom.removeClass("cancel wait run success"),f.dom.hasClass("error")||f.dom.addClass("error").attr("title",a.msg),b.bet[f.which+"_queue"].pushQueue(b.bet[f.which+"_queue"].run.shift(),"error"),f)},f.success=function(){return f.updateMenu(),f.dom.removeClass("cancel wait error run"),f.dom.hasClass("success")||f.dom.addClass("success"),b.bet[f.which+"_queue"].pushQueue(b.bet[f.which+"_queue"].run.shift(),"success"),f},f.wait=function(){return f.state="wait",f.dom.removeClass("cancel success error run"),f.dom.hasClass("wait")||f.dom.addClass("wait"),f},f.cancel=function(){return f.state="cancel",f.dom.removeClass("wait success error run"),f.dom.hasClass("cancel")||f.dom.addClass("cancel"),b.bet[f.which+"_queue"].pushQueue(b.bet[f.which+"_queue"].run.shift(),"cancel"),f},f.destory=function(){f.dom.remove(),f.dom=void 0},f.dealWith=function(a){switch(f.state){case"cancel":f.cancel();break;case"success":f.success();break;case"error":f.error(a);break;case"wait":f.wait();break;case"run":f.run(a)}},f},b.currentRoom=[],b.treasure={imgInit:!1,timer:0,stop:!1,silverSum:0,correctStr:{g:9,z:2,_:4,Z:2,o:0,l:1,B:8,O:0,S:6,s:6,i:1,I:1},silverSeed:!1,allowCtrl:!0,status:"waiting",finished:!1,boxHidden:!1,panelHidden:!0,panelOut:!1,aniStep:1,countdown:null,taskInfo:{startTime:"",endTime:"",minute:"",award:""},captcha:{img:"",userInput:"",question:"",answer:"",refresh:function(){b.treasure.captcha.img=b.treasure.getCaptcha(),b.treasure.treasureTipAcquire.find("img").attr("src",b.treasure.captcha.img),b.treasure.treasureTipAcquire.find("input").val("")}},awardBtn:{text:"领取",bk:"",interval:null,awarding:function(){b.treasure.awardBtn.bk=b.treasure.awardBtn.text,b.treasure.awardBtn.text="领取中.";var a=b.treasure.treasureTip.find(".acquiring-panel .get-award-btn");a.text(b.treasure.awardBtn.text),b.treasure.awardBtn.interval=setInterval(function(){return b.treasure.awardBtn.text.indexOf("...")>-1?(b.treasure.awardBtn.text="领取中",void a.text(b.treasure.awardBtn.text)):(b.treasure.awardBtn.text+=".",void a.text(b.treasure.awardBtn.text))},500)},restore:function(){clearInterval(b.treasure.awardBtn.interval),b.treasure.awardBtn.text=b.treasure.awardBtn.bk}},waitingEmoji:b.randomEmoji.happy(),panelEmoji:b.randomEmoji.helpless(),init:function(){chrome.runtime.sendMessage({command:"getOption",key:"autoTreasure"},function(a){"on"===a.value&&setTimeout(function(){chrome.runtime.sendMessage({command:"getTreasure"},function(a){if(b.treasureBtn.find("span").attr("title","正在初始化"),0===b.mobileVerified)return void b.helperInfo.setTreasureStatus("error","初始化失败，无法通过手机绑定检测");if(void 0===a.data.roomId){chrome.runtime.sendMessage({command:"setTreasure",data:{uid:b.roomInfo.UID,roomId:b.roomInfo.ROOMID,roomShortId:b.roomInfo.roomShortId,roomTitle:b.roomInfo.ROOMTITLE,upName:b.roomInfo.ANCHOR_NICK_NAME,url:location.href}});var c=new Notification("辅助领瓜子功能已经启动",{body:b.roomInfo.ANCHOR_NICK_NAME+"："+b.roomInfo.ROOMTITLE,icon:b.protocol+"//static.hdslb.com/live-static/images/7.png"});if(setTimeout(function(){c.close()},1e4),b.treasure.silverSum=store.get("bilibili_helper_treasure_silver_count"),b.treasure.treasureCtrl=$(".treasure-box-ctnr").clone(),b.treasure.treasureCtrl.attr("id","helperTreasurePlanel"),$(".treasure-box-ctnr").after(b.treasure.treasureCtrl).hide(),b.treasure.treasureBox=b.treasure.treasureCtrl.find(".box-doms"),b.treasure.treasureTip=b.treasure.treasureCtrl.find(".box-panel"),b.treasure.treasureTipWait=b.treasure.treasureCtrl.find(".box-panel .waiting-panel"),b.treasure.treasureTipAcquire=b.treasure.treasureCtrl.find(".box-panel .acquiring-panel"),b.treasure.captchaInput=b.treasure.treasureCtrl.find(".get-award-btn"),b.treasure.canvas=document.createElement("canvas"),b.treasure.canvas.width=120,b.treasure.canvas.height=40,document.body.appendChild(b.treasure.canvas),b.treasure.context=b.treasure.canvas.getContext("2d"),b.treasure.context.font="40px agencyfbbold",b.treasure.context.textBaseline="top",!window.OCRAD){var d=document.createElement("script");d.src=chrome.extension.getURL("ocrad.min.js"),document.body.appendChild(d)}b.treasure.treasureBox.find(".hide-box").on("click",function(){b.treasure.minBox()}),b.treasure.treasureBox.find(".count-down").on("click",function(){b.treasure.maxBox()}),b.treasure.treasureBox.find(".treasure-box").on("click",function(){b.treasure.showPanel()}),b.treasure.treasureTip.find(".close-btn,.waiting-panel .live-btn").on("click",function(){b.treasure.hidePanel()}),b.treasure.treasureTip.find(".acquiring-panel .get-award-btn").on("click",function(){b.treasure.getAward()}),b.treasure.totalTime=1===store.get("bilibili_helper_userInfo").vip?3:5,b.treasure.checkNewTask(),b.treasure.treasureTip.find(".close-btn").click(),$(window).on("beforeunload",function(){chrome.runtime.sendMessage({command:"delTreasure"})}),$(document).mousemove(function(a){b.treasure.stop=!1,b.treasure.timer=0}),setInterval(function(){++b.treasure.timer,b.treasure.timer>=3600&&(b.treasure.stop=!0,b.helperInfo.setTreasureStatus("error","离开太久而暂停了该功能，请手动领取后恢复挂机"))},1e3);var e=chrome.runtime.connect({name:chrome.i18n.getMessage("@@extension_id")});e.onMessage.addListener(function(a){switch(a.command){case"updateCurrentTreasure":var c=a.data.time_start,d=a.data.time_end,e=a.data.minute,f=a.data.silver;b.treasure.setNewTask(c,d,e,f)}}),b.helperInfo.setTreasureStatus("success","功能已经启动")}else a.data.roomId!=b.roomId?(b.helperInfo.setTreasureStatus("wait","已在"+a.data.upName+"的直播间自动领瓜子"),$("#player-container").find(".treasure-box-ctnr").hide("middle"),b.treasure.checkNewTask(!0)):a.data.roomId===b.roomId?(b.helperInfo.setTreasureStatus("wait","本直播间页面已经被打开过"),$("#player-container").find(".treasure-box-ctnr").hide("middle"),b.treasure.checkNewTask(!0)):b.treasure.checkNewTask(!0)})},2e3)})},showBox:function(){b.treasure.boxHidden&&b.treasure.allowCtrl&&(b.treasure.boxHidden=!1)},hideBox:function(){b.treasure.allowCtrl&&!b.treasure.boxHidden&&(b.treasure.boxHidden=!0)},minBox:function(){b.treasure.treasureBox.find(".hide-box,.box-footer,.treasure-box").hide(),b.treasure.treasureBox.find(".count-down-node").addClass("minimal")},maxBox:function(){b.treasure.treasureBox.find(".hide-box,.box-footer,.treasure-box").show(),b.treasure.treasureBox.find(".count-down-node").removeClass("minimal")},showPanel:function(){b.treasure.allowCtrl&&b.treasure.panelHidden&&(b.liveQuickLogin(),b.treasure.panelHidden=!1,b.treasure.captcha.userInput="",b.treasure.waitingEmoji=b.randomEmoji.happy(),b.treasure.panelEmoji=b.randomEmoji.helpless(),b.treasure.treasureBox.find(".hide-box").hide(),"acquirable"===b.treasure.status?b.treasure.makeAcquirable():b.treasure.makeWaiting(),b.treasure.treasureTip.show())},hidePanel:function(){b.treasure.panelHidden||(b.treasure.allowCtrl=!1,b.treasure.panelOut=!0,b.treasure.treasureBox.find(".hide-box").show(),b.treasure.treasureTip.addClass("out"),setTimeout(function(){b.treasure.panelHidden=!0,b.treasure.panelOut=!1,b.treasure.allowCtrl=!0,b.treasure.treasureTip.hide(),b.treasure.treasureTip.removeClass("out")},300))},makeAcquirable:function(){b.treasure.allowCtrl=!0,b.treasure.treasureTipAcquire.show(),b.treasure.treasureTipWait.hide(),b.treasure.treasureTipAcquire.find(".dp-i-block div").html('请输入计算结果领取 <span class="cyan-text">'+b.treasure.taskInfo.award+"</span> 银瓜子 "+b.treasure.panelEmoji),b.treasure.showBox(),b.treasure.treasureTip.addClass("acquire"),b.treasure.playBoxAnimation(),b.treasure.status="acquirable"},makeWaiting:function(){b.treasure.treasureTipAcquire.hide(),b.treasure.treasureTipWait.show(),b.treasure.treasureTip.removeClass("acquire"),b.treasure.treasureTipWait.find(".cyan-text").text(b.treasure.taskInfo.award),b.treasure.treasureTipWait.find(".panel-title").text("宝箱倒计时"+b.treasure.waitingEmoji),b.treasure.status="waiting"},makeFinished:function(){b.treasure.finished=!0,b.setCookie("F_S_T_"+window.UID,1),b.treasure.treasureCtrl&&b.treasure.treasureCtrl.hide("middle"),b.helperInfo.setTreasureStatus("finished","今天的瓜子已经领完")},restoreBox:function(){setTimeout(function(){var a=setInterval(function(){b.treasure.aniStep--,b.treasure.aniStep<=1&&(clearInterval(a),b.treasure.aniStep=1),b.treasure.treasureBox.find(".treasure-box").addClass("animate"+b.treasure.aniStep),b.treasure.treasureBox.find(".treasure-box").removeClass("animate"+(b.treasure.aniStep+1))},100)},250)},playBoxAnimation:function(a){a=a||7;var c=setInterval(function(){return b.treasure.aniStep++,b.treasure.aniStep>=a?void clearInterval(c):(b.treasure.treasureBox.find(".treasure-box").addClass("animate"+b.treasure.aniStep),void b.treasure.treasureBox.find(".treasure-box").removeClass("animate"+(b.treasure.aniStep-1)))},100)},checkNewTask:function(a){b.treasure.getCurrentTask().done(function(c){return void 0===c.code?void console.error("接口数据不完整：code 丢失."):(c.code=parseInt(c.code,10),c.code===-10017?(b.helperInfo.setTreasureStatus("finished","今天的瓜子已经领完"),void b.treasure.makeFinished()):0!==c.code?(console.error("宝箱任务设置失败："+c.msg),c.code===-101||data.code===-99,b.treasure.makeFinished(),void b.helperInfo.setTreasureStatus("error",c.msg)):(chrome.runtime.sendMessage({command:"setCurrentTreasure",data:{minute:c.data.minute,silver:c.data.silver,time_end:c.data.time_end,time_start:c.data.time_start}}),void(a||b.treasure.setNewTask(c.data.time_start,c.data.time_end,parseInt(c.data.minute,10),parseInt(c.data.silver,10)))))}).fail(function(){b.treasure.checkNewTask()})},setNewTask:function(a,c,d,e){b.treasure.hidePanel(),b.treasure.restoreBox(),setTimeout(b.treasure.makeWaiting,300),b.treasure.taskInfo.startTime=a,b.treasure.taskInfo.endTime=c,b.treasure.taskInfo.minute=d,b.treasure.taskInfo.award=e,b.treasure.setCountdown(d)},getAward:function c(){function c(a,c,d){b.treasure.imgInit=!1,b.treasure.stop&&b.helperInfo.setTreasureStatus("success","功能已经启动"),$.get(b.protocol+"//live.bilibili.com/FreeSilver/getAward",{time_start:a,time_end:c,captcha:d},function(){},"json").promise().done(function(a){if(0!=a.code)return b.liveToast(b.treasure.captchaInput[0],"info",a.msg+b.randomEmoji.helpless()),b.treasure.allowCtrl=!0,b.treasure.awardBtn.restore(),void b.treasure.checkNewTask();if(1===parseInt(a.data.isEnd,10))return void b.treasure.makeFinished();b.liveToast(b.treasure.captchaInput[0],"success","已成功领取 "+b.treasure.taskInfo.award+" 银瓜子！"+b.randomEmoji.happy()),b.treasure.updateCurrency(),b.console.watcher("自动领瓜子 成功领取瓜子 "+b.treasure.taskInfo.award+" 个"),b.treasure.silverSum+=b.treasure.taskInfo.award,store.set("bilibili_helper_treasure_silver_count",b.treasure.silverSum);var c=new Notification("自动领取成功",{body:"领取了"+b.treasure.taskInfo.award+"个瓜子",icon:b.protocol+"//static.hdslb.com/live-static/images/7.png"});setTimeout(function(){c.close()},1e4),b.treasure.checkNewTask(),b.treasure.awardBtn.restore(),b.treasure.allowCtrl=!0}).fail(function(e){b.liveToast($captchaInput[0],"error","系统错误，请稍后再试 "+b.randomEmoji.sad()),b.treasure.awardBtn.restore(),b.treasure.allowCtrl=!0,b.treasure.getAward(a,c,d)}).always(function(){b.treasure.captcha.userInput=""})}if(b.treasure.allowCtrl){b.treasure.allowCtrl=!1;var a=b.treasure.treasureTipAcquire.find(".captcha-img");a.on("load",function(){b.treasure.context.clearRect(0,0,b.treasure.canvas.width,b.treasure.canvas.height),b.treasure.context.drawImage(a[0],0,0),b.treasure.captcha.question=b.treasure.correctQuestion(OCRAD(b.treasure.context.getImageData(0,0,120,40))),b.treasure.captcha.answer=b.eval(b.treasure.captcha.question),b.treasure.treasureTipAcquire.find("input").val(b.treasure.captcha.answer);var d=b.treasure.taskInfo;b.treasure.captcha.userInput=b.treasure.captcha.answer;var e=b.treasure.captcha.answer;!b.treasure.stop&&c(d.startTime,d.endTime,e)}),b.treasure.captcha.refresh(),a.on("error",function(){b.treasure.captcha.refresh()})}},updateCurrency:function(){if(!isNaN(parseInt(b.treasure.silverSeed,10))){var a=b.treasure.silverSeed+b.treasure.taskInfo.award;b.treasure.silverSeed=a}},setCountdown:function(a){b.treasure.countdown&&b.treasure.countdown.clearCountdown();var c=new Date,d=c.getMinutes()+a;c.setMinutes(d),b.treasure.countdown=new b.countdown({endTime:c,element:b.treasure.treasureCtrl.find(".count-down-node"),callback:function(){b.treasure.makeAcquirable(),b.treasure.treasureBox.find(".treasure-box").click(),b.treasure.treasureTip.find(".acquiring-panel .get-award-btn").click()}}),b.treasure.allowCtrl=!0},correctQuestion:function(a){var c="",a=a.trim();for(var d in a){var e=b.treasure.correctStr[a[d]];c+=void 0!=e?e:a[d]}return c},getCurrentTask:function(){return $.get(b.protocol+"//live.bilibili.com/FreeSilver/getCurrentTask",{},function(){},"json").promise()},getSurplus:function(){return $.get(b.protocol+"//live.bilibili.com/FreeSilver/getSurplus",{},function(){},"json").promise()},getCaptcha:function(){return b.protocol+"//live.bilibili.com/freeSilver/getCaptcha?ts="+Date.now()}},b.chat={maxLength:20,text:"",beat:!1,colorValue:{white:"0xffffff",red:"0xff6868",blue:"0x66ccff",pink:"0xfca992",cyan:"0x00fffc",green:"0x7eff00",yellow:"0xffed4f",orange:"0xff9800"},danmuMode:{top:5,scroll:1},hideStyle:{chat:{title:"聊天内容",css:"#chat-msg-list .chat-msg{display:none;}",value:"off"},gift:{title:"礼物信息",css:"#chat-msg-list .gift-msg,.gift-msg-1000{display:none !important;}",value:"off"},vipEnterMsg:{title:"老爷进场",css:"#chat-msg-list .system-msg{padding:0 10px;height:auto;}#chat-msg-list .system-msg .live-icon,#chat-msg-list .system-msg .welcome,#chat-msg-list .system-msg .admin.square-icon,#chat-msg-list .system-msg .v-middle{display: none;}",value:"off"},liveTitleIcon:{title:"成就头衔",css:"#chat-msg-list .chat-msg .check-my-title{display:none;}",value:"off"},mediaIcon:{title:"粉丝勋章",css:"#chat-msg-list .chat-msg .fans-medal-item{display:none;}",value:"off"},userLevel:{title:"用户等级",css:"#chat-msg-list .chat-msg .user-level-icon{display:none;}",value:"off"},chatBg:{title:"聊天背景",css:"#chat-list-ctnr{background:#f8f8f8!important;}",value:"off"},superGift:{title:"礼物连击",css:".live-haruna-ctnr{display:none;}",value:"off"},announcement:{title:"系统通告",css:"#chat-msg-list .announcement-container{display:none;}",value:"off"}},displayOption:[],init:function(){b.chat.chat_ctrl_panel=$("#chat-ctrl-panel"),b.chat.counter=b.chat.chat_ctrl_panel.find(".danmu-length-count"),chrome.runtime.sendMessage({command:"getOption",key:"danmu"},function(a){"on"===a.value&&($("#chat-ctrl-panel").append($('<div class="room-silent-merge dp-none p-absolute p-zero help-chat-shade" style="display:block;"><p><span class="hint-text"></span>弹幕增强功能正在初始化</p></div>')),setTimeout(b.chat.initDanmu,2e3))}),chrome.runtime.sendMessage({command:"getOption",key:"chatDisplay"},function(a){"on"===a.value&&b.chat.initChatDisplay(!0)})},sendDamu:function(){if(b.chat.text.length>0){$(".color-select-panel").attr("data-dd"),$(".mode-select-panel").find("a.active").attr("class").split(" ",3)[1];console.log(chrome.windows),console.log($("#player_object")[0])}},initDanmu:function(){var a=b.chat.chat_ctrl_panel.find(".chat-ctrl-btns .btns .emoji"),c=a.clone().addClass("helper-emoji");a.before(c).remove();var d=b.chat.chat_ctrl_panel.find(".ctrl-panels .emoji-panel"),e=d.clone().addClass("helper-emoji-list");d.before(e).remove();var f=b.chat.chat_ctrl_panel.find(".chat-ctrl-btns .btns .hot-words"),g=f.clone().addClass("helper-hot-words");f.before(g).remove();var h=b.chat.chat_ctrl_panel.find(".ctrl-panels .hot-words-panel"),i=h.clone().addClass("helper-hot-words-list");h.before(i).remove();var j=b.chat.chat_ctrl_panel.find(".danmu-sender #danmu-textbox");b.chat.maxLength=j.attr("maxlength"),b.chat.helper_text_area=j.clone().addClass("helper-text-area").removeAttr("maxlength"),j.before(b.chat.helper_text_area).remove();var k=b.chat.chat_ctrl_panel.find(".danmu-sender #danmu-send-btn"),l=k.clone().addClass("helper-send-btn");k.before(l).remove(),b.chat.maxLength=parseInt(store.get("bilibili_helper_userInfo").userLevel)>=20?30:20,b.chat.counter.text("0 / 1 + 0"),b.scriptOptions.chat={colorValue:b.chat.colorValue,danmuMode:b.chat.danmuMode,maxLength:b.chat.maxLength},c.on("click",function(){if("none"===e.css("display")){var a=function b(a){var c=a&&(a.target||a.srcElement);c&&c.className.indexOf("emoji-panel")>-1||$(".emoji-panel").fadeOut(200,function(){$(window).off("click",b)})};e.show(),setTimeout(function(){$(window).on("click",a)},1)}}),g.on("click",function(){if("none"===i.css("display")){var a=function b(a){var c=a&&(a.target||a.srcElement);c&&c.className.indexOf("hot-words-panel")>-1||$(".hot-words-panel").fadeOut(200,function(){$(window).off("click",b)})};i.show(),setTimeout(function(){$(window).on("click",a)},1)}}),b.chat.helper_text_area.on("keydown",function(a){var c=b.chat.helper_text_area.val().trim();return 13===a.keyCode&&""===c?(a.preventDefault(),b.liveToast(l,"info","请输入弹幕后再发送~"),b.chat.helper_text_area.val(""),!1):13===a.keyCode&&""!=c?(a.preventDefault(),0===b.chat.text.length?(b.chat.helper_text_area.val(c.substr(0,c.length)),l.click()):(b.chat.text+=c,b.chat.helper_text_area.val(""),b.chat.updateCounter("")),!1):void b.chat.updateCounter(c)}),b.chat.helper_text_area.on("keyup",function(){var a=b.chat.helper_text_area.val().trim();b.chat.updateCounter(a)}),e.on("click","a",function(){var a=b.chat.helper_text_area.val().trim();b.chat.helper_text_area.val(a+$(this).text()),b.chat.helper_text_area.focus(),b.chat.updateCounter(b.chat.helper_text_area.val().trim())}),i.on("click","a",function(){var a=b.chat.helper_text_area.val().trim();b.chat.helper_text_area.val(a+$(this).text()),b.chat.helper_text_area.focus(),b.chat.updateCounter(b.chat.helper_text_area.val().trim())}),b.chat.chat_ctrl_panel.find(".help-chat-shade").hide("middle")},initChatHelper:function(){b.chat.chat_ctrl_panel.find("#chatHelper").remove(),b.chat.chatHelper=$('<div id="chatHelper"></div>').css("background-image","url("+chrome.extension.getURL("imgs/jinkela.png")+")"),b.chat.chatDisplayBlock=$('<div class="chat-display"><h2 class="panel-title">屏蔽选项</h2></div>'),b.chat.chatHelperWindow=$('<div id="chatHelperWindow" class="chat-helper-panel ctrl-panel"></div>').hide(),b.each(b.chat.hideStyle,function(a){var c=$('<div class="display-option"><span class="title">'+b.chat.hideStyle[a].title+'</span><div class="option"><div class="button '+a+("on"===b.chat.hideStyle[a].value?" on":"")+'" option="on">屏蔽</div><div class="button '+a+("off"===b.chat.hideStyle[a].value?" on":"")+'" option="off">显示</div></div></div>');b.chat.chatDisplayBlock.append(c)}),b.chat.chatHelperWindow.append(b.chat.chatDisplayBlock),b.chat.chat_ctrl_panel.append(b.chat.chatHelper,b.chat.chatHelperWindow),b.chat.chatHelper.off("click").on("click",function(){if("none"===b.chat.chatHelperWindow.css("display")){var a=function c(a){var b=a&&(a.target||a.srcElement);!$(b).hasClass("chat-helper-panel")&&!$(b).parents("#chatHelperWindow").length&&$(".chat-helper-panel").fadeOut(200,function(){$(window).off("click",c)})};b.chat.chatHelperWindow.show(),setTimeout(function(){$(window).on("click",a)},1)}}),b.chat.chatDisplayBlock.find(".display-option .option .button").off("click").on("click",function(){var a=$(this).attr("class").split(" ")[1];if($(this).hasClass("on"))return!1;
$("."+a).removeClass("on"),$(this).addClass("on");var c=$(this).attr("option");if("on"===c){var d=b.chat.displayOption.indexOf(a);d===-1&&b.chat.displayOption.push(a)}else{var d=b.chat.displayOption.indexOf(a);d!=-1&&b.chat.displayOption.splice(d,1)}var e=void 0;(e=store.get("bilibili_helper_chat_display"))[b.roomId]=b.chat.displayOption,store.set("bilibili_helper_chat_display",e),b.chat.initChatDisplay()})},initChatDisplay:function(a){chrome.runtime.sendMessage({command:"getOption",key:"displayOption"},function(c){var d=store.get("bilibili_helper_chat_display")[b.roomId]||[],e=d.length?d:[],f=JSON.parse(c.value),g=void 0,h=void 0,i=0;e.length>f.length?(g=e,h=f):(g=f,h=e),i=g.length;for(var j=0;j<g.length;++j)h.indexOf(g[j])>=0&&--i;i?e.length?b.chat.displayOption=e:b.chat.displayOption=f:(store["delete"]("bilibili_helper_chat_display",b.roomId),b.chat.displayOption=f);var k=b.chat.displayOption;b.each(b.chat.hideStyle,function(a){var c=k.indexOf(a);c<0?($(".chatDisplayStyle_"+a).remove(),b.chat.hideStyle[a].value="off"):0===$(".chatDisplayStyle_"+a).length&&(b.chat.addStylesheet(a),b.chat.hideStyle[a].value="on")}),a&&b.chat.initChatHelper()})},addStylesheet:function(a){var c=document.createElement("style");c.setAttribute("class","chatDisplayStyle_"+a),c.setAttribute("type","text/css"),c.appendChild(document.createTextNode(b.chat.hideStyle[a].css)),document.head?document.head.appendChild(c):document.documentElement.appendChild(c)},updateCounter:function(a){var c=parseInt(a.length/b.chat.maxLength),d=c>0?a.length%b.chat.maxLength:0;b.chat.counter.text(a.length+" / "+(0===c?1:c)+" + "+d)}},b.notise={init:function(){var a={};b.getRoomInfo().done(function(c){a.uid=c.data.UID,a.roomId=c.data.ROOMID,a.roomShortI=location.pathname.substr(1),a.roomTitle=c.data.ROOMTITLE,a.upName=c.data.ANCHOR_NICK_NAME,a.url=location.href;var d=$("<div>").addClass("mid-part").append('<i class="live-icon-small favourite p-relative" style="top: 1px"></i><span>特别关注</span>').click(function(){$(this).find("i").hasClass("favourited")?chrome.runtime.sendMessage({command:"setNotFavourite",id:a.roomId},function(a){a.data&&(d.find("span").html("特别关注"),d.find("i").removeClass("favourited"))}):chrome.runtime.sendMessage({command:"setFavourite",upInfo:a},function(a){a.data&&d.find("span").html("已特别关注"),d.find("i").addClass("favourited")})}).hover(function(){$(this).attr("title","关注之后再特别关注会在主播开播时进行推送哦"+b.randomEmoji.happy())});chrome.runtime.sendMessage({command:"getFavourite"},function(a){a.data.indexOf(parseInt(b.roomId))!=-1&&(d.find("span").html("已特别关注"),d.find("i").addClass("favourited"))}),$(".attend-button").find(".left-part").after(d)})}},b.smallTV={tvList:{},count:0,reward:{},rewardList:{1:{title:"大号小电视"},2:{title:"蓝白胖次道具"},3:{title:"B坷垃"},4:{title:"喵娘"},5:{title:"便当"},6:{title:"银瓜子"},7:{title:"辣条"}},init:function(){b.smallTV.reward=store.get("bilibili_helper_tvs_reward"),b.smallTV.count=store.get("bilibili_helper_tvs_count")},getTVdata:function(a){if(b.smallTV.tvList[a]){var c=void 0!=a?b.smallTV.tvList[a].iter:void 0;console.log("获取第"+(c+1)+"个小电视数据");var d=void 0!=c&&b.smallTV.tvList[a].tv[c];return d}},get:function(a){$.getJSON("/SmallTV/index",{roomid:a,_:(new Date).getTime()}).promise().done(function(c){if(0==c.code)if(c.data.unjoin.length||c.data.join.length,b.console.watcher("监测到小电视抽奖活动 直播间【"+a+"】"),c.data.lastid)b.console.watcher("小电视活动 直播间【"+a+"】 抽奖已经结束");else{b.console.watcher("小电视活动 直播间【"+a+"】 成功获取抽奖信息");var d=c.data.unjoin;void 0==b.smallTV.tvList[a]&&(b.smallTV.tvList[a]={tv:[],iter:0});for(var e=0;e<d.length;++e){var f=d[e];f.finished=!1,f.joined=!1,f.drawIn=!1,b.smallTV.tvList[a].tv.push(f),b.smallTV.notify(a)}}}).fail(function(c){b.smallTV.get(a)})},notify:function(a){$.getJSON("/SmallTV/index",{roomid:a,_:(new Date).getTime()}).promise().done(function(c){if(0==c.code)if(c.data.unjoin.length||c.data.join.length,b.console.watcher("监测到小电视抽奖活动 直播间【"+a+"】"),c.data.lastid)b.console.watcher("小电视活动 直播间【"+a+"】 抽奖已经结束");else{b.console.watcher("小电视活动 直播间【"+a+"】 成功获取抽奖信息");var d=c.data.unjoin;void 0==b.smallTV.tvList[a]&&(b.smallTV.tvList[a]={tv:[],iter:0}),d.length>0&&chrome.runtime.sendMessage({command:"tvNotification",data:{roomId:a}},function(a){})}}).fail(function(c){b.smallTV.notify(a)})}},b.watcher={able:!1,options:{tv:!1},notifyStatus:!1,notifyOptions:{tv:!1},panelDOM:{ty:void 0},init:function(a){chrome.runtime.sendMessage({command:"getOption",key:"watcher"},function(c){"on"===c.value&&setTimeout(function(){chrome.runtime.sendMessage({command:"getWatcherRoom"},function(c){b.watcherBtn.find("span").attr("title","正在初始化"),b.mobileVerified?(void 0===c.data.roomId?(b.getRoomInfo().done(function(a){chrome.runtime.sendMessage({command:"setWatcherRoom",data:{uid:a.data.UID,roomId:a.data.ROOMID,roomShortId:location.pathname.substr(1),roomTitle:a.data.ROOMTITLE,upName:a.data.ANCHOR_NICK_NAME,url:location.href}})}),chrome.runtime.sendMessage({command:"getOption",key:"watchList"},function(c){var d=c.value?JSON.parse(c.value):[];b.scriptOptions.watcher=[],b.each(d,function(a){var c=b.watcher.options[d[a]];c===!1&&(b.watcher.options[d[a]]=!0,b.scriptOptions.watcher.push(d[a]),b.console.watcher("启动:"+d[a]))}),b.watcher.initRewardPanel(),$(window).on("beforeunload",function(a){chrome.runtime.sendMessage({command:"delWatcherRoom"})}),b.watcher.options.tv&&(b.smallTV.init(),b.watcher.updateReward("tv")),document.addEventListener("sendMessage",function(a){var c=store.get("bilibili_helper_message");return!!c.cmd&&void b.watcher.classify(c)}),b.watcher.initData(),"function"==typeof a&&a()}),chrome.runtime.sendMessage({command:"getOption",key:"watchNotify"},function(a){b.watcher.notifyStatus="on"===a.value}),chrome.runtime.sendMessage({command:"getOption",key:"watchNotifyList"},function(a){var c=a.value?JSON.parse(a.value):[];b.each(c,function(a){var d=b.watcher.notifyOptions[c[a]];d||(b.watcher.notifyOptions[c[a]]=!0)})}),b.helperInfo.setWatcherStatus("success","功能已经启动")):(chrome.runtime.sendMessage({command:"getOption",key:"watchList"},function(a){var c=a.value?JSON.parse(a.value):[];b.each(c,function(a){b.watcher.options[c[a]]=!0}),b.watcher.initRewardPanel()}),b.helperInfo.setWatcherStatus("wait","监控功能已在【"+c.data.upName+"】的直播间启动"),"function"==typeof a&&a()),b.watcher.able=!0):b.helperInfo.setWatcherStatus("error","初始化失败，无法通过手机绑定检测")})},2e3)})},initData:function(){chrome.runtime.sendMessage({command:"getOption",key:"watcherDataClean"},function(a){var c=store.get("bilibili_helper_watcher_data_date"),d=(new Date).getFullYear(),e=(new Date).getMonth()+1,f=(new Date).getDate(),g=d+"-"+e+"-"+f;"0"!==a.value&&("1"===a.value?(void 0===c?b.watcher.cleanData():c!=g&&b.watcher.cleanData(),store.set("bilibili_helper_watcher_data_date",g)):"2"===a.value&&(!c||b.getDateDiff(c,g)>=7)&&(b.watcher.cleanData(),store.set("bilibili_helper_watcher_data_date",g)))})},cleanData:function(){store.set("bilibili_helper_tvs_reward",{}),store.set("bilibili_helper_tvs_count",0),store.set("bilibili_helper_lottery_reward",{}),store.set("bilibili_helper_lottery_count",0)},classify:function(a){switch(a.cmd){case"DANMU_MSG":b.console.info("danmu",a);break;case"SYS_MSG":b.console.info("system",a),b.watcher.options.tv&&b.watcher.dealWithSysMsg(a);break;case"TV_END":break;case"SEND_GIFT":b.console.info("gift",a);break;case"SYS_GIFT":b.console.info("sys_gift",a),b.watcher.options.lottery&&b.watcher.dealWithSysGift(a)}},dealWithSysMsg:function(a){var c=a.msg;if("【"===c[0]&&""!=a.url&&1===a.rep&&2===a.styleType){var d=new RegExp("【([\\S]+)】在直播间【([\\d]+)】"),e=d.exec(c),f=e[2];b.getRoomIdByUrl(f,function(a){b.smallTV.notify(a)})}},dealWithSysGift:function(a){var c=a.tips;if("string"==typeof c||a.giftId)switch(a.giftId){case 39:var d=new RegExp("在直播间【([0-9]+)】"),e=d.exec(c),f=e[1];b.getRoomIdByUrl(f,function(a){b.beat.getBeat(a).done(function(c){if(c.data[39].id){var d=c.data[39].content;b.beat.sendBeat(a,d);var e=b.lottery.reward[6];void 0===e&&(e=0),b.lottery.reward[6]=++e,store.set("bilibili_helper_lottery_reward",b.lottery.reward),b.watcher.updateReward("lottery")}})})}},pushNotification:function(a,b,c,d){var e=new Notification(b,{body:c,icon:d});setTimeout(function(){e.close()},5e3)},initRewardPanel:function(){if(b.watcher.options.tv){b.watcher.panelDOM.tv=$("<div />").addClass("tv reward-panel");var a=$("<span />").addClass("reward-counter"),c=$("<div />").addClass("reward-title").text("小电视抽奖").append(a),d=$("<div />").addClass("reward-container");b.watcher.panelDOM.tv.append(c,d)}},updateReward:function(a){var c={},d=0,e=void 0;if(b.watcher.able){switch(a){case"tv":c=store.get("bilibili_helper_tvs_reward"),d=store.get("bilibili_helper_tvs_count"),e=b.smallTV.rewardList}if(e&&b.watcher.panelDOM[a]){b.watcher.panelDOM[a].find(".reward-container").empty();var f=0;b.each(c,function(d){++f;var g=e[d]?e[d].title:b.giftList[d]?b.giftList[d].title:"神秘礼物",h=c[d],i=$("<span />").addClass("gift").text(g+"x"+b.numFormat(h));b.watcher.panelDOM[a].find(".reward-container").append(i)}),f||b.watcher.panelDOM[a].find(".reward-container").append($('<span class="gift">没有获奖记录</span>'))}b.watcher.panelDOM[a]&&b.watcher.panelDOM[a].find(".reward-counter").text(d+" 次")}}},b.giftpackage={giftPackageStatus:0,panelStatus:!1,giftPackageData:{},giftPackageMap:{},giftSendAll:{open:function(){b.giftpackage.sendLineSection.empty();var a=[];b.each(b.giftpackage.giftPackageMap,function(c){var d=b.giftpackage.giftPackageMap[c];b.each(d,function(e){var f=d[e],g=$("<span />").addClass("package-item").attr({title:f.gift_name,gift_id:c,bag_id:f.id}),h=$("<div />").addClass("gift-item gift-item-package gift-"+c);f.expireat>0?h.html('<span class="expires">'+f.expireat+"天</span>"):0===f.expireat?h.html('<span class="expires">今天</span>'):h.html('<span class="expires">永久</span>');var i=$("<div />").addClass("gift-count").text("x"+f.gift_num);g.append(h,i),b.giftpackage.sendLineSection.append(g),a.push(f)})}),a.length>0&&($(document).click(),b.giftpackage.sendLinePanel.show(),b.giftpackage.giftSendLinePanel.giftsData=a)}},giftSendLinePanel:{line_id:null,giftsData:{},outTimeout:null,open:function(a){$(document).click(),b.giftpackage.giftSendLinePanel.line_id=a,b.giftpackage.giftSendLinePanel.giftsData=b.giftpackage.giftPackageMap[a];var c=b.giftpackage.giftSendLinePanel.giftsData;b.giftpackage.sendLinePanel.show(),b.giftpackage.sendLineSection.empty(),b.each(b.giftpackage.giftSendLinePanel.giftsData,function(d){var e=c[d],f=$("<span />").addClass("package-item").attr({title:e.gift_name,gift_id:a,bag_id:e.id}),g=$("<div />").addClass("gift-item gift-item-package gift-"+a);e.expireat>0?g.html('<span class="expires">'+e.expireat+"天</span>"):0===e.expireat?g.html('<span class="expires">今天</span>'):g.html('<span class="expires">永久</span>');var h=$("<div />").addClass("gift-count").text("x"+e.gift_num);f.append(g,h),b.giftpackage.sendLineSection.append(f)})},close:function(){var a=b.giftpackage.giftSendLinePanel;b.giftpackage.sendLinePanel.addClass("hide out"),a.outTimeout=setTimeout(function(){b.giftpackage.sendLinePanel.removeClass("hide out").css("display","")},380)},sendLine:function(a){if("keyup"!==a.type||13===a.keyCode){var c=b.giftpackage.giftSendLinePanel.giftsData,d={complete:0};b.giftpackage.giftSendLinePanel.send(c,d,b.giftpackage.giftSendLinePanel.callback)}},send:function(a,c,d){var e=a[c.complete];$.ajax({url:"/giftBag/send",type:"POST",data:{giftId:e.gift_id,roomid:b.roomId,ruid:b.roomInfo.MASTERID,num:e.gift_num,coinType:"silver",Bag_id:e.id,timestamp:Date.now(),rnd:store.get("bilibili_helper_live_danmu_rnd",b.roomId),token:b.getCookie("LIVE_LOGIN_DATA")||""},dataType:"JSON",success:function(f){0===f.code?"function"==typeof d&&d(a,c):1===f.code?(console.error("系统繁忙，正在重试"),setTimeout(function(){b.giftpackage.giftSendLinePanel.send(e)},500)):console.error(f)}})},callback:function(a,c){++c.complete,c.complete===a.length?b.giftpackage.giftSendLinePanel.close():b.giftpackage.giftSendLinePanel.send(a,c,b.giftpackage.giftSendLinePanel.callback)}},giftSendPanel:{giftData:{giftId:"",giftName:"",giftNum:0,type:"silver",count:1,bagId:0},show:!1,out:!1,outTimeout:null,toggleGiftPackage:function(a){a.stopPropagation(),b.liveQuickLogin(),b.giftpackage.panelStatus?b.giftpackage.closeGiftPackagePanel():1===b.giftpackage.giftPackageStatus?b.giftpackage.giftPackageNewPanel.open():b.giftpackage.openGiftPackagePanel()},open:function(a,c,d,e){var f=b.giftpackage.giftSendPanel;f.giftData.giftId=a,f.giftData.giftName=c,f.giftData.giftNum=d,f.giftData.count=d,f.giftData.bagId=e,$(document).click(),b.giftpackage.sendNumberGroup.empty();for(var g=["1","5","10","30","50","5%","10%","30%","50%","MAX"],h=0;h<g.length;++h){var i=$("<span />").addClass("number-btn").text(g[h]);h<5&&d<parseInt(g[h])&&i.addClass("disabled"),b.giftpackage.sendNumberGroup.append(i),i.off("click").on("click",function(a){var c=$(this).text();switch(c){case"1":case"5":case"10":case"30":case"50":var e=parseInt(c);d<e&&(e=d),b.giftpackage.sendGiftInput.val(e);break;case"5%":case"10%":case"30%":case"50%":var e=Math.ceil(.01*parseInt(c.substr(0,c.length-1))*d);d<e&&(e=d),b.giftpackage.sendGiftInput.val(e);break;case"MAX":b.giftpackage.sendGiftInput.val(d)}})}b.giftpackage.sendGiftImg.attr("class","gift-img float-left gift-"+a),b.giftpackage.sendGiftInfo.text("您的包裹中还剩 "+d+" 个可用"),b.giftpackage.sendGiftInput.val(d).focus(),b.giftpackage.sendPanel.show(),setTimeout(function(){$(document).on("click",a);var a=function c(a){var d=a&&(a.target||a.srcElement);$(d).hasClass("panel-content")||$(d).parents(".panel-content").length||($(document).off("click",c),b.giftpackage.giftSendPanel.close())}},1)},close:function(){var a=b.giftpackage.giftSendPanel;b.giftpackage.sendPanel.addClass("hide out"),a.outTimeout=setTimeout(function(){b.giftpackage.sendPanel.removeClass("hide out").css("display","")},380)},sendGift:function(a){if("keyup"!==a.type||13===a.keyCode){var c=a.target||a.srcElement,d=b.giftpackage.giftSendPanel.giftData;d.count=b.giftpackage.sendGiftInput.val();var e=parseInt(d.count,10),f=store.get("bilibili_helper_live_danmu_rnd",b.roomId);return isNaN(e)?(d.count="",void b.liveToast(b.giftpackage.sendGiftInput,"error","请填写正确的送礼数量 "+b.randomEmoji.helpless())):void $.ajax({url:"/giftBag/send",type:"POST",data:{giftId:d.giftId,roomid:b.roomId,ruid:b.roomInfo.MASTERID,num:d.count,coinType:d.type,Bag_id:d.bagId,timestamp:Date.now(),rnd:f,token:b.getCookie("LIVE_LOGIN_DATA")||""},dataType:"JSON",success:function(a){if(0===a.code){var e=function(a){var b={uname:a.data.uname,num:a.data.num,giftName:a.data.giftName,giftId:a.data.giftId};f.innerHTML='<div class="gift-msg-item"><span class="user-name-low">'+b.uname+'</span> <span class="action">赠送'+b.giftName+'</span><div class="gift-img gift-'+b.giftId+'" role="img"></div>X <span class="gift-count">'+b.num+"</span></div>"};b.liveToast(c,"info","Gift-sending is successful. "+b.randomEmoji.helpless()),1===a.data.data.giftType&&$("#player_object")[0].sendGift(a.data.data.giftId,a.data.data.num);var f=document.getElementById("gift-msg-1000");parseInt(a.data.data.num,10)<10&&e(a.data),a.data.data.notice_msg&&$("#player_object")[0].noticeGift(a.data.data.notice_msg),d.giftNum=a.data.remain,b.giftpackage.sendGiftInfo.text("您的包裹中还剩 "+d.giftNum+" 个可用"),b.giftpackage.sendGiftInput.focus(),0===a.data.remain&&(b.giftpackage.sendGiftInput.val(0),b.giftpackage.giftSendPanel.close())}else 1===a.code?console.error("系统繁忙..."):a.code===-400&&"余额不足"===a.msg?b.giftpackage.giftSendPanel.close():c&&b.liveToast(c,"caution",a.msg+" "+b.randomEmoji.sad())},error:function(a){c&&b.liveToast(c,"error",b.randomEmoji.sad()+" 送礼失败："+a.statusText+" "+b.randomEmoji.sad())}})}}},giftPackageNewPanel:{data:[],show:!1,out:!1,outTimeout:null,open:function(){b.giftpackage.getSendGift(function(a){0===a.code&&(b.giftpackage.giftPackageNewPanel.data=a.data)})},close:function(){var a=b.giftpackage.giftPackageNewPanel;a.out=!0,a.outTimeout=setTimeout(function(){a=null,b.giftpackage.giftPackageStatus=2,b.giftpackage.openGiftPackagePanel()},380)}},init:function(){chrome.runtime.sendMessage({command:"getOption",key:"giftpackage"},function(a){"on"===a.value&&($("#gift-panel").find(".control-panel .items-package").hide(),b.giftpackage.controlPanel=$("#gift-panel").find(".control-panel"),b.giftpackage["package"]=b.giftpackage.controlPanel.find(".items-package").clone().css("display","inline-block"),b.giftpackage.controlPanel.find(".items-package").after(b.giftpackage["package"]),b.giftpackage.packageBtn=b.giftpackage["package"].find(".link"),b.giftpackage.packagePanel=b.giftpackage["package"].find(".gifts-package-panel"),b.giftpackage.packageContent=b.giftpackage["package"].find(".gifts-package-content"),b.giftpackage.packagePanelTitle=b.giftpackage.packagePanel.find(".gifts-package-title"),b.giftpackage.packagePanelCleanBtn=$("<span />").addClass("gifts-package-clean").text("清空包裹"),b.giftpackage.packagePanelTitle.append(b.giftpackage.packagePanelCleanBtn),b.giftpackage.sendPanel=$("#gift-package-send-panel"),b.giftpackage.sendContent=$("#gift-package-send-panel").find(".panel-content"),b.giftpackage.sendGiftImg=b.giftpackage.sendPanel.find(".gift-img"),b.giftpackage.sendGiftInfo=b.giftpackage.sendPanel.find(".gift-info p"),b.giftpackage.sendGiftInput=b.giftpackage.sendPanel.find("input").clone(),b.giftpackage.sendPanel.find("input").after(b.giftpackage.sendGiftInput).hide(),b.giftpackage.sendGiftBtn=b.giftpackage.sendPanel.find("button").clone(),b.giftpackage.sendPanel.find("button").after(b.giftpackage.sendGiftBtn).hide(),b.giftpackage.sendNumberGroup=$("<div />").addClass("number-group"),b.giftpackage.sendContent.append(b.giftpackage.sendNumberGroup),b.giftpackage.sendLinePanel=$("#gift-package-send-panel").clone().attr("id","gift-package-send-line-panel"),b.giftpackage.sendPanel.after(b.giftpackage.sendLinePanel),b.giftpackage.sendLineSection=b.giftpackage.sendLinePanel.find(".section").empty(),b.giftpackage.sendLinePanel.find("input").hide(),b.giftpackage.sendLineBtn=b.giftpackage.sendLinePanel.find("button:eq(1)"),b.giftpackage.packageBtn.off("click").on("click",function(a){b.giftpackage.openGiftPackagePanel()}),b.giftpackage.sendContent.find(".close-btn").off("click").on("click",function(a){b.giftpackage.giftSendPanel.close()}),b.giftpackage.sendLinePanel.find(".close-btn").off("click").on("click",function(a){b.giftpackage.giftSendLinePanel.close()}),b.giftpackage.sendGiftInput.off("keydown").on("keydown",function(a){13===a.keyCode&&""!=b.giftpackage.sendGiftInput.val()&&b.giftpackage.giftSendPanel.sendGift(a)}),b.giftpackage.sendGiftBtn.off("click").on("click",function(a){b.giftpackage.giftSendPanel.sendGift(a)}),b.giftpackage.sendLineBtn.off("click").on("click",function(a){b.giftpackage.giftSendLinePanel.sendLine(a)}),b.scriptOptions.giftpackage=!0)})},initGiftsDOM:function(a){b.giftpackage.packageContent.empty(),b.giftpackage.packagePanel.removeClass("big"),b.each(a,function(c){var d=a[c],e=$("<div />").addClass("gift-item-group").attr("gift_id",c);b.each(d,function(a){var b=d[a],f=$("<span />").addClass("package-item").attr({title:b.gift_name,gift_id:c,bag_id:b.id}),g=$("<div />").addClass("gift-item gift-item-package gift-"+c);b.expireat>0?g.html('<span class="expires">'+b.expireat+"天</span>"):0===b.expireat?g.html('<span class="expires">今天</span>'):g.html('<span class="expires">永久</span>');var h=$("<div />").addClass("gift-count").text("x"+b.gift_num);f.append(g,h),e.append(f).css("width",54*d.length+"px")});var f=$("<div />").addClass("send_line").text("清空本行"),g=$("<div />").addClass("container").append(f,e);b.giftpackage.packageContent.append(g),d.length>10&&b.giftpackage.packagePanel.addClass("big")}),b.giftpackage.packagePanelCleanBtn&&b.giftpackage.packagePanelCleanBtn.off("click").on("click",function(a){b.giftpackage.giftSendAll.open()}),b.giftpackage.packageContent.find(".package-item").off("click").on("click",function(a){var c=$(this).attr("bag_id"),d=b.giftpackage.giftPackageData[c];b.giftpackage.giftSendPanel.open(d.gift_id,d.gift_name,d.gift_num,d.id)}),b.giftpackage.packageContent.find(".send_line").off("click").on("click",function(a){var c=$(this).parent().find(".gift-item-group").attr("gift_id");b.giftpackage.giftSendLinePanel.open(c)})},sortGifts:function(a){var c={},d=a;return b.giftpackage.giftPackageData={},b.each(d,function(a){var e=d[a];b.giftpackage.giftPackageData[e.id]=e,"今日"===e.expireat?e.expireat=0:0===e.expireat?e.expireat=-1:e.expireat=parseInt(e.expireat),void 0===c[e.gift_id]&&(c[e.gift_id]=[]);var f=0;b.each(c[e.gift_id],function(a){e.expireat<c[e.gift_id][a].expireat&&f>=a?f=a:f>=a&&(f=a+1)}),c[e.gift_id].splice(f,0,e)}),c},getGiftPackage:function(){return $.get(b.protocol+"//live.bilibili.com/gift/playerBag",{},function(){},"json").promise()},getSendGift:function(){return $.get(b.protocol+"//live.bilibili.com/giftBag/getSendGift",{},function(){},"json").promise()},getGiftPackageStatus:function(){return $.get(b.protocol+"//live.bilibili.com/giftBag/sendDaily",{},function(){},"json").promise()},openGiftPackagePanel:function(){"none"==b.giftpackage.packagePanel.css("display")&&(b.giftpackage.getGiftPackage().then(function(a){b.giftpackage.giftPackageMap=b.giftpackage.sortGifts(a.data),b.giftpackage.initGiftsDOM(b.giftpackage.giftPackageMap),b.giftpackage.packagePanel.show()}),setTimeout(function(){$(document).on("click",b.giftpackage.closeGiftPackagePanel)},1))},closeGiftPackagePanel:function(a){var c=a&&(a.target||a.srcElement);$(c).hasClass("gifts-package-panel")||$(c).parents(".gifts-package-panel").length||b.giftpackage.packagePanel.hide(0,function(){b.giftpackage.panelStatus=!1,$(document).off("click",b.giftpackage.closeGiftPackagePanel)})}},b.helperInfo={setStatus:function(a,b,c){a.hasClass(c)||a.attr("class",b).addClass(c)},setWatcherStatus:function(a,c){b.helperInfo.setStatus(b.watcherBtn,"watcher-info",a),b.watcherBtn.find("span").attr("title",c),b.watcher.updateReward("tv"),b.watcher.updateReward("lottery")},setTreasureStatus:function(a,c){b.helperInfo.setStatus(b.treasureBtn,"treasure-info",a),b.treasureBtn.find("span").attr("title",c)},initPanel:function(){var a=$("#head-info-panel"),c=a.find(".info-ctnr"),d=c.find(".room-info"),e=d.find(".room-title-row"),f=d.find(".anchor-info-row"),g=$("<span />").addClass("helper-anchor-info-btn").text("更多"),h=b.createPanel(e,g,"click","helper-anchor-info-panel","helperAnchorInfoPanel"),i=d.find(".room-info.v-top:eq(0)"),j=d.find(".room-info.v-top:eq(1)"),k=d.find(".room-manage"),l=e.find(".report-link[href]"),m=e.find(".share-link"),n=f.find(".san-info").hide(),o=(n.attr("href"),n.find(".san-num")),p=$('<div class="row-item san-info"><span class="san">San ：</span></div>').append(o);h.append(p,i,j,k,l,m),b.helperInfoRow=$("<div />").addClass("helper-info-panel").attr("id","helperInfoPanel"),c.find(".room-info.float-left").append(b.helperInfoRow),chrome.runtime.sendMessage({command:"getOption",key:"watcher"},function(a){"on"===a.value&&(b.watcherBtn=$("<div />").addClass("watcher-info").html('<i class="watcher-info-icon" style="background-image:url('+chrome.extension.getURL("imgs/icon.png")+')"></i><span class="watcher-info-text">抽奖提示功能</span>'),b.helperInfoRow.append(b.watcherBtn))}),chrome.runtime.sendMessage({command:"getOption",key:"autoTreasure"},function(a){"on"===a.value&&(b.treasureBtn=$("<div />").addClass("treasure-info").html('<i class="treasure-info-icon" style="background-image:url('+chrome.extension.getURL("imgs/icon.png")+')"></i><span class="treasure-info-text">辅助领瓜子</span>'),b.helperInfoRow.append(b.treasureBtn))})}},b.init={"do":function(){b.init.localStorage(),b.init.ad(),b.init.userInfo(function(a){store.get("bilibili_helper_login","login")&&location.pathname.substr(1)&&!isNaN(location.pathname.substr(1))&&chrome.runtime.sendMessage({command:"getOption",key:"version"},function(a){b.version=a.value;var c=store.get("bilibili_helper_version");c&&c==b.version||store.set("bilibili_helper_version",b.version),$("#gift-panel").find(".control-panel").prepend('<div class="ctrl-item version"><span title="version: '+b.version+'">哔哩哔哩助手</span> by <a href="http://weibo.com/guguke" target="_blank">@啾咕咕www</a> <a href="http://weibo.com/ruo0037" target="_blank">@沒睡醒的肉啊</a></div>'),b.init.style(),b.init.medal(),b.addScriptByText('(function(){if (location.pathname.substr(1) && !isNaN(location.pathname.substr(1))) {var a=function(f,d,c){if(!window.localStorage||!f){return}var e=window.localStorage;if(!e[f]){e[f]=JSON.stringify({})}var b=JSON.parse(e[f]);if(c==undefined){e[f]=typeof d=="string"?d.trim():JSON.stringify(d)}else{b[d]=typeof c=="string"?c.trim():JSON.stringify(c);e[f]=JSON.stringify(b)}};a("bilibili_helper_live_roomId",ROOMURL,ROOMID);a("bilibili_helper_live_danmu_rnd",ROOMURL,DANMU_RND);}})();'),b.roomId=b.getRoomId(),b.getRoomInfo().done(function(a){b.init.giftList(),b.roomInfo=a.data,b.roomInfo.roomShortId=location.pathname.substr(1),b.helperInfo.initPanel(),setTimeout(function(){b.mobileVerified&&(b.doSign.init(),b.chat.init(),b.notise.init(),b.giftpackage.init()),b.treasure.init(),b.watcher.init(),b.helperInfoRow.css("opacity",1)},2500),setTimeout(function(){b.addScriptByFile("live-content-script.min.js",b.scriptOptions)},5e3),Notification.requestPermission()})})})},style:function(){var a=$("document").find("#bilibiliHelperLive");a.length&&a.remove(),b.init.inject_css("bilibiliHelperLive","live.min.css")},inject_css:function(a,b){var c=document.createElement("link");c.setAttribute("id",a),c.setAttribute("type","text/css"),c.setAttribute("rel","stylesheet"),c.setAttribute("href",chrome.extension.getURL(b)),document.head?document.head.appendChild(c):document.documentElement.appendChild(c)},ad:function(){chrome.runtime.sendMessage({command:"getAd"},function(a){"on"===a.value&&b.init.inject_css("bilibiliHelperAdStyle","bilibiliHelperAd.min.css")})},giftList:function(){var a=$(".gifts-ctnr .gift-item[role=listitem]");if(a.length>0)for(var c=0;c<a.length;++c){var d=$(a[c]),e=d.attr("data-gift-id");isNaN(parseInt(e))||(b.giftList[e]={title:d.attr("data-title"),type:d.attr("data-type"),description:d.attr("data-desc")})}},clearLocalStorage:function(){store["delete"]("bilibili_helper_quiz_bet",b.roomId),store["delete"]("bilibili_helper_quiz_check",b.roomId),store["delete"]("bilibili_helper_quiz_number",b.roomId),store["delete"]("bilibili_helper_quiz_rate",b.roomId),store["delete"]("bilibili_helper_quiz_which",b.roomId),store["delete"]("bilibili_helper_doSign"),store["delete"]("bilibili_helper_userInfo")},localStorage:function(){b.init.clearLocalStorage(),store.has("bilibili_helper_init")?b.hasInit=!0:store.set("bilibili_helper_init",!0),store.has("bilibili_helper_live_roomId")||store.set("bilibili_helper_live_roomId",{}),!store.has("bilibili_helper_doSign")&&store.set("bilibili_helper_doSign",{}),!store.has("bilibili_helper_userInfo")&&store.set("bilibili_helper_userInfo",{}),!store.has("bilibili_helper_treasure_silver_count")&&store.set("bilibili_helper_treasure_silver_count",0),!store.has("bilibili_helper_chat_display")&&store.set("bilibili_helper_chat_display",{}),!store.has("bilibili_helper_tvs_count")&&store.set("bilibili_helper_tvs_count",0),!store.has("bilibili_helper_tvs_reward")&&store.set("bilibili_helper_tvs_reward",{}),!store.has("bilibili_helper_lottery_count")&&store.set("bilibili_helper_lottery_count",0),!store.has("bilibili_helper_lottery_reward")&&store.set("bilibili_helper_lottery_reward",{}),!store.has("bilibili_helper_lottery_reward_list")&&store.set("bilibili_helper_lottery_reward_list",{}),!store.has("bilibili_helper_quiz_autoMode")&&store.set("bilibili_helper_quiz_autoMode",{}),!store.has("bilibili_helper_quiz_check")&&store.set("bilibili_helper_quiz_check",{}),!store.has("bilibili_helper_quiz_bet")&&store.set("bilibili_helper_quiz_bet",{}),!store.has("bilibili_helper_quiz_rate")&&store.set("bilibili_helper_quiz_rate",{}),!store.has("bilibili_helper_quiz_number")&&store.set("bilibili_helper_quiz_number",{}),!store.has("bilibili_helper_quiz_which")&&store.set("bilibili_helper_quiz_which",{}),!store.has("bilibili_helper_beat_roomList")&&store.set("bilibili_helper_beat_roomList",[])},userInfo:function(a){b.getUser().done(function(c){if("REPONSE_OK"===c.code){var c=c.data;b.user=c,store.set("bilibili_helper_userInfo",{username:c.uname,userLevel:c.user_level,silver:c.silver,gold:c.gold,face:c.face,vip:c.vip,svip:c.svip,billCoin:c.billCoin,rank:c.user_level_rank}),store.set("bilibili_helper_login",!0),$.ajax({dataType:"json",url:b.protocol+"//space.bilibili.com/ajax/member/MyInfo"}).promise().done(function(d){d.data&&1===d.data.mobile_verified?b.mobileVerified=1:(b.mobileVerified=0,console.error("未绑定手机，直播间功能无法启用")),a&&"function"==typeof a&&a(c)})}else c.code===-101&&store.remove("bilibili_helper_userInfo")})},medal:function(){b.getMedalList().done(function(a){$.get(b.protocol+"//live.bilibili.com/i/medal").promise().done(function(c){var d=$(c),e=d.find(".my-medal-section dl dd");if(0===a.code){a=a.data,b.medalList=a;for(var f in a){b.medalList[f].rank=parseInt($(e[f]).find(".col-4").text());var g=a[f];4765===g.medalId?(b.hasBBQ=!0,b.BBQ=g):b.hasBBQ=!1}}})})}},b.init["do"]()}}();