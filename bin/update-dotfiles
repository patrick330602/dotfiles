#!/bin/sh

# Update the repository
if [ -d "$HOME/.dotfiles" ]; then
    echo "::Updating repository..."
    (
        cd "$HOME/.dotfiles" || exit
        # force pull to overwrite local commits
        git fetch --all -q
        git reset --hard origin/main -q
        git pull origin main -q
    )
fi

# install starship config
# if starship config already exists and not symlinked, back it up
if test -f "$HOME/.config/starship.toml"; then
    if ! test -L "$HOME/.config/starship.toml"; then
        echo "::Not symlinked Starship Config; Backing up existing starship configuration..."
        mv "$HOME/.config/starship.toml" "$HOME/.config/starship.toml.bak"
        echo "::Installing starship configuration..."
        mkdir -p "$HOME/.config"
        ln -s "$HOME/.dotfiles/starship.toml" "$HOME/.config/starship.toml"
    fi
else
    echo "::Starship Config not found; Installing starship configuration..."
    mkdir -p "$HOME/.config"
    ln -s "$HOME/.dotfiles/starship.toml" "$HOME/.config/starship.toml"
fi


# install configuration nvim-config.vim to ~/.config/nvim/init.vim
# backup existing init.vim if it exists
if test -f "$HOME/.config/nvim/init.vim"; then
    echo "::Backing up existing nvim configuration..."
    mv "$HOME/.config/nvim/init.vim" "$HOME/.config/nvim/init.vim.bak"
fi
echo "::Updating nvim configuration..."
mkdir -p "$HOME/.config/nvim"
ln -s "$HOME/.dotfiles/nvim-config.vim" "$HOME/.config/nvim/init.vim"
nvim +PlugClean +PlugUpdate +PlugUpgrade +qall +silent


echo "::Done! Please restart your shell."